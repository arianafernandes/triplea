<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>MapXmlCreator.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">test (25/nov/2016 10:16:58)</a> &gt; <a href="../../index.html" class="el_group">triplea</a> &gt; <a href="../index.html" class="el_bundle">src</a> &gt; <a href="index.source.html" class="el_package">tools.map.xml.creator</a> &gt; <span class="el_source">MapXmlCreator.java</span></div><h1>MapXmlCreator.java</h1><pre class="source lang-java linenums"><span class="nc" id="L1">package tools.map.xml.creator;</span>

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Component;
import java.awt.ComponentOrientation;
import java.awt.Dimension;
import java.awt.FlowLayout;
import java.awt.Font;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.GridLayout;
import java.awt.HeadlessException;
import java.awt.Insets;
import java.awt.event.ActionListener;
import java.awt.event.InputEvent;
import java.awt.event.KeyEvent;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FilenameFilter;
import java.io.IOException;
import java.nio.file.Paths;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Optional;
import java.util.Set;
import java.util.logging.Level;
import java.util.logging.Logger;

import javax.swing.AbstractAction;
import javax.swing.Action;
import javax.swing.Box;
import javax.swing.BoxLayout;
import javax.swing.JButton;
import javax.swing.JEditorPane;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JMenu;
import javax.swing.JMenuBar;
import javax.swing.JMenuItem;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTabbedPane;
import javax.swing.JTextArea;
import javax.swing.KeyStroke;
import javax.swing.SwingUtilities;
import javax.swing.border.EmptyBorder;
import javax.swing.border.MatteBorder;
import javax.swing.text.Document;
import javax.swing.text.html.HTMLEditorKit;
import javax.xml.parsers.ParserConfigurationException;
import javax.xml.transform.OutputKeys;
import javax.xml.transform.Transformer;
import javax.xml.transform.TransformerException;
import javax.xml.transform.TransformerFactory;
import javax.xml.transform.dom.DOMSource;
import javax.xml.transform.stream.StreamResult;

import org.xml.sax.SAXException;

import games.strategy.debug.ClientLogger;
import games.strategy.engine.data.GameParser;
import games.strategy.engine.framework.lookandfeel.LookAndFeel;
import games.strategy.engine.framework.startup.mc.GameSelectorModel;
import games.strategy.ui.SwingAction;
import tools.image.FileSave;

/**
 * A frame that will show the different steps creating a game XML.
 */
public class MapXmlCreator extends JFrame {
  private static final String BUTTON_LABEL_SAVE_MAP_XML = &quot;Save Map XML&quot;;
  private static final String FILE_NAME_CENTERS_TXT = &quot;centers.txt&quot;;
  static final String FILE_NAME_ENDING_XML = &quot;.xml&quot;;
  private static final String FILE_NAME_ENDING_GIF = &quot;.gif&quot;;
  public static final String FILE_NAME_ENDING_PNG = &quot;.png&quot;;
  private static final long serialVersionUID = 3593102638082774498L;
  public static final String TRIPLEA_MAP_FOLDER = &quot;triplea.map.folder&quot;;
  public static final String TRIPLEA_UNIT_ZOOM = &quot;triplea.unit.zoom&quot;;
  public static final String TRIPLEA_UNIT_WIDTH = &quot;triplea.unit.width&quot;;
  public static final String TRIPLEA_UNIT_HEIGHT = &quot;triplea.unit.height&quot;;

<span class="nc" id="L87">  private GameStep highestStep = GAME_STEP_FIRST;</span>

<span class="nc" id="L89">  static File mapImageFile = null;</span>
<span class="nc" id="L90">  static File mapCentersFile = null;</span>
<span class="nc" id="L91">  static File mapPolygonsFile = null;</span>
<span class="nc" id="L92">  static String waterFilterString = &quot;&quot;;</span>
<span class="nc" id="L93">  static File mapFolderLocation = null;</span>

  final JPanel mainPanel;
  final JPanel sidePanel;
<span class="nc" id="L97">  final JPanel stepPanel = new JPanel();</span>
  private JPanel stepListPanel;
<span class="nc" id="L99">  private final ArrayList&lt;GameStepLabel&gt; stepList = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L100">  private final JPanel southPanel = new JPanel();</span>
  private JPanel southCenterPanel;
  private JButton buttonHelp;
  private JButton buttonBack;
  private JButton autoFillButton;
  private JButton nextButton;
  private final JPanel stepActionPanel;

  public JPanel getStepActionPanel() {
<span class="nc" id="L109">    return stepActionPanel;</span>
  }


  private final JLabel stepTitleLabel;
  private final JPanel actionPanel;
<span class="nc" id="L115">  private GameStep currentStep = GAME_STEP_FIRST;</span>

<span class="nc" id="L117">  final public static GameStep GAME_STEP_FIRST = GameStep.MAP_PROPERTIES;</span>
  public static final String MAP_XML_CREATOR_LOGGER_NAME = &quot;Logger for Map XML Creation&quot;;

<span class="nc" id="L120">  public static enum GameStep {</span>
<span class="nc" id="L121">    MAP_PROPERTIES, TERRITORY_DEFINITIONS, TERRITORY_CONNECTIONS, PLAYERS_AND_ALLIANCES, UNIT_DEFINITIONS, GAMEPLAY_SEQUENCE, PLAYER_SEQUENCE, TECHNOLOGY_DEFINITIONS, PRODUCTION_FRONTIERS, UNIT_ATTACHMENTS, TERRITORY_PRODUCTION, CANAL_DEFINITIONS, TERRITORY_OWNERSHIP, UNIT_PLACEMENTS, GAME_SETTINGS, MAP_FINISHED</span>
  }

  public static GameStep getMaxGameStep(final GameStep step1, final GameStep step2) {
<span class="nc bnc" id="L125" title="All 2 branches missed.">    return (step1.ordinal() &gt;= step2.ordinal()) ? step1 : step2;</span>
  }

  private static String getGameStepName(final GameStep step) {
<span class="nc bnc" id="L129" title="All 17 branches missed.">    switch (step) {</span>
      case MAP_PROPERTIES:
<span class="nc" id="L131">        return &quot;Map Properties&quot;;</span>
      case TERRITORY_DEFINITIONS:
<span class="nc" id="L133">        return &quot;Territory Definitions&quot;;</span>
      case TERRITORY_CONNECTIONS:
<span class="nc" id="L135">        return &quot;Territory Connections&quot;;</span>
      case PLAYERS_AND_ALLIANCES:
<span class="nc" id="L137">        return &quot;Players and Alliances&quot;;</span>
      case UNIT_DEFINITIONS:
<span class="nc" id="L139">        return &quot;Unit Definitions&quot;;</span>
      case GAMEPLAY_SEQUENCE:
<span class="nc" id="L141">        return &quot;Gameplay Sequence&quot;;</span>
      case PLAYER_SEQUENCE:
<span class="nc" id="L143">        return &quot;Player Sequence&quot;;</span>
      case TECHNOLOGY_DEFINITIONS:
<span class="nc" id="L145">        return &quot;Technology Definitions&quot;;</span>
      case PRODUCTION_FRONTIERS:
<span class="nc" id="L147">        return &quot;Production Frontiers&quot;;</span>
      case UNIT_ATTACHMENTS:
<span class="nc" id="L149">        return &quot;Unit Attachments&quot;;</span>
      case TERRITORY_PRODUCTION:
<span class="nc" id="L151">        return &quot;Territory Production&quot;;</span>
      case CANAL_DEFINITIONS:
<span class="nc" id="L153">        return &quot;Canal Definitions&quot;;</span>
      case TERRITORY_OWNERSHIP:
<span class="nc" id="L155">        return &quot;Territory Ownership&quot;;</span>
      case UNIT_PLACEMENTS:
<span class="nc" id="L157">        return &quot;Unit Placements&quot;;</span>
      case GAME_SETTINGS:
<span class="nc" id="L159">        return &quot;Game Settings&quot;;</span>
      case MAP_FINISHED:
<span class="nc" id="L161">        return &quot;Map finished!&quot;;</span>
      default:
<span class="nc" id="L163">        throw new IllegalArgumentException(</span>
<span class="nc" id="L164">            &quot;Provided value is not valid for &quot; + GameStep.class);</span>
    }
  }

  private static GameStep getNextGameStepTo(final GameStep step_cur) {
<span class="nc bnc" id="L169" title="All 17 branches missed.">    switch (step_cur) {</span>
      case MAP_PROPERTIES:
<span class="nc" id="L171">        return GameStep.TERRITORY_DEFINITIONS;</span>
      case TERRITORY_DEFINITIONS:
<span class="nc" id="L173">        return GameStep.TERRITORY_CONNECTIONS;</span>
      case TERRITORY_CONNECTIONS:
<span class="nc" id="L175">        return GameStep.PLAYERS_AND_ALLIANCES;</span>
      case PLAYERS_AND_ALLIANCES:
<span class="nc" id="L177">        return GameStep.UNIT_DEFINITIONS;</span>
      case UNIT_DEFINITIONS:
<span class="nc" id="L179">        return GameStep.GAMEPLAY_SEQUENCE;</span>
      case GAMEPLAY_SEQUENCE:
<span class="nc" id="L181">        return GameStep.PLAYER_SEQUENCE;</span>
      case PLAYER_SEQUENCE:
<span class="nc" id="L183">        return GameStep.TECHNOLOGY_DEFINITIONS;</span>
      case TECHNOLOGY_DEFINITIONS:
<span class="nc" id="L185">        return GameStep.PRODUCTION_FRONTIERS;</span>
      case PRODUCTION_FRONTIERS:
<span class="nc" id="L187">        return GameStep.UNIT_ATTACHMENTS;</span>
      case UNIT_ATTACHMENTS:
<span class="nc" id="L189">        return GameStep.TERRITORY_PRODUCTION;</span>
      case TERRITORY_PRODUCTION:
<span class="nc" id="L191">        return GameStep.CANAL_DEFINITIONS;</span>
      case CANAL_DEFINITIONS:
<span class="nc" id="L193">        return GameStep.TERRITORY_OWNERSHIP;</span>
      case TERRITORY_OWNERSHIP:
<span class="nc" id="L195">        return GameStep.UNIT_PLACEMENTS;</span>
      case UNIT_PLACEMENTS:
<span class="nc" id="L197">        return GameStep.GAME_SETTINGS;</span>
      case GAME_SETTINGS:
<span class="nc" id="L199">        return GameStep.MAP_FINISHED;</span>
      case MAP_FINISHED:
<span class="nc" id="L201">        return GameStep.MAP_FINISHED;</span>
      default:
<span class="nc" id="L203">        throw new IllegalArgumentException(</span>
<span class="nc" id="L204">            &quot;'&quot; + step_cur + &quot;' is not a valid string for &quot; + GameStep.class);</span>
    }
  }

  private static GameStep getPrevGameStepTo(final GameStep currentStep) {
<span class="nc bnc" id="L209" title="All 17 branches missed.">    switch (currentStep) {</span>
      case MAP_PROPERTIES:
<span class="nc" id="L211">        return GameStep.MAP_PROPERTIES;</span>
      case TERRITORY_DEFINITIONS:
<span class="nc" id="L213">        return GameStep.MAP_PROPERTIES;</span>
      case TERRITORY_CONNECTIONS:
<span class="nc" id="L215">        return GameStep.TERRITORY_DEFINITIONS;</span>
      case PLAYERS_AND_ALLIANCES:
<span class="nc" id="L217">        return GameStep.TERRITORY_CONNECTIONS;</span>
      case UNIT_DEFINITIONS:
<span class="nc" id="L219">        return GameStep.PLAYERS_AND_ALLIANCES;</span>
      case GAMEPLAY_SEQUENCE:
<span class="nc" id="L221">        return GameStep.UNIT_DEFINITIONS;</span>
      case PLAYER_SEQUENCE:
<span class="nc" id="L223">        return GameStep.GAMEPLAY_SEQUENCE;</span>
      case TECHNOLOGY_DEFINITIONS:
<span class="nc" id="L225">        return GameStep.PLAYER_SEQUENCE;</span>
      case PRODUCTION_FRONTIERS:
<span class="nc" id="L227">        return GameStep.TECHNOLOGY_DEFINITIONS;</span>
      case UNIT_ATTACHMENTS:
<span class="nc" id="L229">        return GameStep.PRODUCTION_FRONTIERS;</span>
      case TERRITORY_PRODUCTION:
<span class="nc" id="L231">        return GameStep.UNIT_ATTACHMENTS;</span>
      case CANAL_DEFINITIONS:
<span class="nc" id="L233">        return GameStep.TERRITORY_PRODUCTION;</span>
      case TERRITORY_OWNERSHIP:
<span class="nc" id="L235">        return GameStep.CANAL_DEFINITIONS;</span>
      case UNIT_PLACEMENTS:
<span class="nc" id="L237">        return GameStep.TERRITORY_OWNERSHIP;</span>
      case GAME_SETTINGS:
<span class="nc" id="L239">        return GameStep.UNIT_PLACEMENTS;</span>
      case MAP_FINISHED:
<span class="nc" id="L241">        return GameStep.GAME_SETTINGS;</span>
      default:
<span class="nc" id="L243">        throw new IllegalArgumentException(</span>
<span class="nc" id="L244">            &quot;'&quot; + currentStep + &quot;' is not a valid string for &quot; + GameStep.class);</span>
    }
  }

  public static String[] getProperties() {
<span class="nc" id="L249">    return new String[] {TRIPLEA_MAP_FOLDER, TRIPLEA_UNIT_ZOOM, TRIPLEA_UNIT_WIDTH, TRIPLEA_UNIT_HEIGHT};</span>
  }


<span class="nc" id="L253">  final private static Logger logger = Logger.getLogger(MAP_XML_CREATOR_LOGGER_NAME);</span>

  public static Logger getLogger() {
<span class="nc" id="L256">    return logger;</span>
  }

  public static void main(final String[] args) {
<span class="nc" id="L260">    MapXmlCreator.getLogger().setLevel(Level.OFF);</span>
<span class="nc" id="L261">    MapXmlCreator.log(Level.INFO, &quot;Starting MapXMLCreator&quot;);</span>

    // handleCommandLineArgs(args);
<span class="nc" id="L264">    LookAndFeel.setupLookAndFeel();</span>
<span class="nc" id="L265">    start();</span>
<span class="nc" id="L266">  }</span>

  public static void start() {
<span class="nc" id="L269">    SwingUtilities.invokeLater(() -&gt; {</span>
<span class="nc" id="L270">      final MapXmlCreator creator = new MapXmlCreator();</span>
<span class="nc" id="L271">      creator.setSize(800, 600);</span>
<span class="nc" id="L272">      creator.setPreferredSize(creator.getSize());</span>
<span class="nc" id="L273">      creator.goToStep(GAME_STEP_FIRST);</span>
<span class="nc" id="L274">      creator.setLocationRelativeTo(null);</span>
<span class="nc" id="L275">      creator.setVisible(true);</span>
<span class="nc" id="L276">    });</span>
<span class="nc" id="L277">  }</span>

  public MapXmlCreator() {
<span class="nc" id="L280">    super(&quot;TripleA Map XML Creator&quot;);</span>

<span class="nc" id="L282">    mapFolderLocation = getDefaultMapFolderLocation();</span>

<span class="nc" id="L284">    final File myFile = getDefaultMapXmlFile();</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">    if (myFile.exists()) {</span>
      try {
<span class="nc" id="L287">        loadXmlFromFilePath(myFile.getAbsolutePath());</span>
<span class="nc" id="L288">      } catch (SAXException | IOException | ParserConfigurationException e) {</span>
<span class="nc" id="L289">        getLogger().log(Level.WARNING,</span>
<span class="nc" id="L290">            &quot;Default Map XML File could not be loaded from '&quot; + myFile.getAbsolutePath() + &quot;'.&quot;, e);</span>
<span class="nc" id="L291">        throw new IllegalStateException(</span>
<span class="nc" id="L292">            &quot;Default Map XML File could not be loaded from '&quot; + myFile.getAbsolutePath() + &quot;'.&quot;);</span>
      }
    }

<span class="nc" id="L296">    setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span>

<span class="nc" id="L298">    final Action openAction = createMenuBar();</span>

    // components
<span class="nc" id="L301">    mainPanel = new JPanel();</span>
<span class="nc" id="L302">    sidePanel = new JPanel();</span>
<span class="nc" id="L303">    createStepListPanel();</span>

<span class="nc" id="L305">    sidePanel.setLayout(new BoxLayout(sidePanel, BoxLayout.Y_AXIS));</span>
<span class="nc" id="L306">    sidePanel.add(Box.createVerticalStrut(2));</span>
<span class="nc" id="L307">    sidePanel.add(stepListPanel);</span>
<span class="nc" id="L308">    sidePanel.add(Box.createVerticalGlue());</span>


<span class="nc" id="L311">    stepListPanel.setLayout(new GridLayout(stepList.size(), 1, 0, 10));</span>
<span class="nc" id="L312">    stepListPanel.setBorder(new EmptyBorder(10, 2, 0, 5));</span>
<span class="nc" id="L313">    stepListPanel.setPreferredSize(new Dimension(170, 410));</span>

    // set up the layout manager
<span class="nc" id="L316">    this.getContentPane().setLayout(new BorderLayout());</span>
<span class="nc" id="L317">    final JScrollPane scrollPane = new JScrollPane(sidePanel);</span>
<span class="nc" id="L318">    scrollPane.setBorder(new MatteBorder(1, 1, 1, 1, Color.DARK_GRAY));</span>
<span class="nc" id="L319">    this.getContentPane().add(scrollPane, BorderLayout.WEST);</span>
<span class="nc" id="L320">    this.getContentPane().add(mainPanel, BorderLayout.CENTER);</span>

    // now set up the main screen
<span class="nc" id="L323">    setupMainPanel(stepPanel);</span>
<span class="nc" id="L324">    stepPanel.setLayout(new BoxLayout(stepPanel, BoxLayout.PAGE_AXIS));</span>

<span class="nc" id="L326">    stepPanel.add(Box.createVerticalStrut(20));</span>

<span class="nc" id="L328">    stepTitleLabel = new JLabel(&quot;Map Properties&quot;);</span>
<span class="nc" id="L329">    stepTitleLabel.setFont(new Font(MapXmlUIHelper.defaultMapXMLCreatorFontName, Font.BOLD, 12));</span>
<span class="nc" id="L330">    stepTitleLabel.setAlignmentX(Component.CENTER_ALIGNMENT);</span>
<span class="nc" id="L331">    stepPanel.add(stepTitleLabel);</span>

<span class="nc" id="L333">    stepPanel.add(Box.createVerticalStrut(20));</span>

<span class="nc" id="L335">    actionPanel = new JPanel();</span>
<span class="nc" id="L336">    actionPanel.setLayout(new BorderLayout());</span>
<span class="nc" id="L337">    actionPanel.setBorder(new MatteBorder(1, 0, 0, 0, Color.DARK_GRAY));</span>
<span class="nc" id="L338">    stepActionPanel = new JPanel();</span>
<span class="nc" id="L339">    stepPanel.add(actionPanel);</span>

<span class="nc" id="L341">    actionPanel.add(stepActionPanel, BorderLayout.CENTER);</span>

<span class="nc" id="L343">    layoutSouthPanel();</span>

<span class="nc bnc" id="L345" title="All 2 branches missed.">    if (!myFile.exists()) {</span>
<span class="nc" id="L346">      openAction.actionPerformed(null);</span>
    }
<span class="nc" id="L348">  }</span>

  /**
   * @return
   */
  public File getDefaultMapXmlFile() {
<span class="nc" id="L354">    return new File(getDefaultMapFolderLocation() + File.separator + &quot;new_world_order&quot;</span>
<span class="nc" id="L355">        + File.separator + &quot;games&quot; + File.separator + &quot;new_world_order.xml&quot;);</span>
  }

  /**
   * @return
   */
  public File getDefaultMapFolderLocation() {
    // return new File(ClientFileSystemHelper.getRootFolder() + File.separator + &quot;maps&quot;);
<span class="nc" id="L363">    return new File(Paths.get(&quot;.&quot; + File.separator + &quot;maps&quot;).toAbsolutePath().normalize().toString());</span>
  }

  /**
   * @return
   */
  private Action createMenuBar() {
    // set up the actions
<span class="nc" id="L371">    final Action openAction = SwingAction.of(&quot;Load Map XML&quot;, e -&gt; {</span>
      final GameStep goToStep;
<span class="nc" id="L373">      goToStep = MapXmlCreator.loadXML();</span>
<span class="nc" id="L374">      highestStep = goToStep;</span>
<span class="nc" id="L375">      DynamicRowsPanel.me = Optional.empty();</span>
<span class="nc" id="L376">      SwingUtilities.invokeLater(() -&gt; {</span>
<span class="nc" id="L377">        goToStep(goToStep);</span>
<span class="nc" id="L378">        validateAndRepaint();</span>
<span class="nc" id="L379">      });</span>
<span class="nc" id="L380">    });</span>
<span class="nc" id="L381">    openAction.putValue(Action.SHORT_DESCRIPTION, &quot;Load an existing Map XML File&quot;);</span>
<span class="nc" id="L382">    final Action saveAction = SwingAction.of(BUTTON_LABEL_SAVE_MAP_XML, e -&gt; {</span>
<span class="nc" id="L383">      stepActionPanel.requestFocus();</span>
<span class="nc bnc" id="L384" title="All 4 branches missed.">      if (!DynamicRowsPanel.me.isPresent() || DynamicRowsPanel.me.get().dataIsConsistent()) {</span>
<span class="nc" id="L385">        MapXmlCreator.saveXML();</span>
      }
<span class="nc" id="L387">    });</span>
<span class="nc" id="L388">    saveAction.putValue(Action.SHORT_DESCRIPTION, &quot;Save the Map XML to File&quot;);</span>
<span class="nc" id="L389">    final Action exitAction = SwingAction.of(&quot;Exit&quot;, e -&gt; System.exit(0));</span>
<span class="nc" id="L390">    exitAction.putValue(Action.SHORT_DESCRIPTION, &quot;Exit The Program&quot;);</span>
    // set up the menu items
<span class="nc" id="L392">    final JMenuItem openItem = new JMenuItem(openAction);</span>
<span class="nc" id="L393">    openItem.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_O, InputEvent.CTRL_MASK));</span>
<span class="nc" id="L394">    final JMenuItem saveItem = new JMenuItem(saveAction);</span>
<span class="nc" id="L395">    saveItem.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_S, InputEvent.CTRL_MASK));</span>
<span class="nc" id="L396">    final JMenuItem exitItem = new JMenuItem(exitAction);</span>
    // set up the menu bar
<span class="nc" id="L398">    final JMenuBar menuBar = new JMenuBar();</span>
<span class="nc" id="L399">    final JMenu fileMenu = new JMenu(&quot;File&quot;);</span>
<span class="nc" id="L400">    fileMenu.setMnemonic(KeyEvent.VK_F);</span>
<span class="nc" id="L401">    fileMenu.add(openItem);</span>
<span class="nc" id="L402">    fileMenu.add(saveItem);</span>
<span class="nc" id="L403">    fileMenu.addSeparator();</span>
<span class="nc" id="L404">    fileMenu.add(exitItem);</span>
<span class="nc" id="L405">    menuBar.add(fileMenu);</span>
<span class="nc" id="L406">    setJMenuBar(menuBar);</span>
<span class="nc" id="L407">    return openAction;</span>
  }

  private void createStepListPanel() {
<span class="nc" id="L411">    stepListPanel = new JPanel();</span>
<span class="nc" id="L412">    GameStep step_cur = null;</span>
<span class="nc" id="L413">    GameStep step_next = GAME_STEP_FIRST;</span>
<span class="nc" id="L414">    int stepCounter = 1;</span>
<span class="nc bnc" id="L415" title="All 2 branches missed.">    while (step_cur != step_next) {</span>
<span class="nc" id="L416">      step_cur = step_next;</span>
<span class="nc" id="L417">      final GameStepLabel gameStepLabelCur =</span>
<span class="nc" id="L418">          new GameStepLabel(stepCounter + &quot;: &quot; + getGameStepName(step_cur), step_cur);</span>
<span class="nc" id="L419">      stepListPanel.add(gameStepLabelCur);</span>
<span class="nc" id="L420">      stepList.add(gameStepLabelCur);</span>
<span class="nc" id="L421">      ++stepCounter;</span>
<span class="nc" id="L422">      step_next = getNextGameStepTo(step_cur);</span>
    }
<span class="nc" id="L424">  }</span>

  private void layoutSouthPanel() {
<span class="nc" id="L427">    mainPanel.add(southPanel, BorderLayout.SOUTH);</span>
<span class="nc" id="L428">    southPanel.setLayout(new BoxLayout(southPanel, BoxLayout.X_AXIS));</span>

<span class="nc" id="L430">    final JPanel southLeftPanel = new JPanel();</span>
<span class="nc" id="L431">    southLeftPanel.setComponentOrientation(ComponentOrientation.LEFT_TO_RIGHT);</span>
<span class="nc" id="L432">    final FlowLayout southLeftPanelFlowLayout = (FlowLayout) southLeftPanel.getLayout();</span>
<span class="nc" id="L433">    southLeftPanelFlowLayout.setAlignment(FlowLayout.LEFT);</span>
<span class="nc" id="L434">    southLeftPanel.setBorder(null);</span>
<span class="nc" id="L435">    southPanel.add(southLeftPanel);</span>

<span class="nc" id="L437">    southPanel.add(Box.createHorizontalGlue());</span>

<span class="nc" id="L439">    createButtonHelp();</span>
<span class="nc" id="L440">    southLeftPanel.add(buttonHelp);</span>

<span class="nc" id="L442">    southCenterPanel = new JPanel();</span>
<span class="nc" id="L443">    southPanel.add(southCenterPanel);</span>

<span class="nc" id="L445">    southPanel.add(Box.createHorizontalGlue());</span>

<span class="nc" id="L447">    addSouthCenterPanelButtons();</span>

<span class="nc" id="L449">    final JPanel southRightPanel = new JPanel();</span>
<span class="nc" id="L450">    final FlowLayout southRightPanelFlowLayout = (FlowLayout) southRightPanel.getLayout();</span>
<span class="nc" id="L451">    southRightPanelFlowLayout.setAlignment(FlowLayout.RIGHT);</span>
<span class="nc" id="L452">    southPanel.add(southRightPanel);</span>

<span class="nc" id="L454">    final JButton buttonAvailableChoices = MapXmlUIHelper.createButton(&quot;Available Choices&quot;, KeyEvent.VK_C);</span>
<span class="nc" id="L455">    buttonAvailableChoices.addActionListener(e -&gt; {</span>
<span class="nc bnc" id="L456" title="All 17 branches missed.">      switch (currentStep) {</span>

        case MAP_PROPERTIES: // TODO: Verify message text.
          // showInfoMessage(&quot;Map Name: The map name that is displayed in the New Game window in TripleA.
          // Examples: Revised, Classic, Big World, and Great War\r\rMap Version: The version of the map's
          // xml file. Examples: 0.0.1, 1.0.0.1, and 1.1\r\rResource Name: The name of the resource used in
          // the map. Resources can be thought of as buying tokens or currency used to buy units, technology,
          // etc. 'IPCs' have recently been replaced by 'PUs'. 'IPCs' will no longer work as the map resource.
          // \r\rMap Image Location: The location of the map image. Example: C:/My Maps/Sleeping
          // Giant/full_map.png\r\rMap Centers File: The location of the centers file produced by the
          // 'Center Picker' program. The centers file is used to automatically add the map's territories.
          // Example: C:/My Maps/Sleeping Giant/centers.txt\r\rWater Territory Filter: An optional setting
          // that makes the program automatically apply the 'Is Water' property to every territory that contains
          // the filter text. Examples: SZ, Sea Zone, Pacific, and Atlantic.&quot;, &quot;Help For Current Step&quot;);
<span class="nc" id="L470">          break;</span>

        case TERRITORY_DEFINITIONS: // TODO: Verify message text.
          // showInfoMessage(&quot;To add a new territory, click somewhere on the map and enter a name for the
          // territory in the window that appears. \r If you want to change the properties of a territory,
          // left click on it and answer each question. The color of the territory label changes for each
          // property that is applies. If you want to remove a territory label, right click on it and click yes
          // when it asks for confirmation.&quot;, &quot;Help For Current Step&quot;);
          // showInfoMessage(&quot;Right click to rename a territory. \r If you want to change the properties of a
          // territory, left click on it. \r The color of the territory label changes for each property that is
          // applied.&quot;, &quot;Help For Current Step&quot;);
<span class="nc" id="L481">          break;</span>

        case TERRITORY_CONNECTIONS: // TODO: Verify message text.
          // showInfoMessage(&quot;To add a connection between two territories, click on the first territory in the
          // connection and then the second. To remove all the connections from a certain territory, right click
          // on it and click yes.\r\rNote: To have the program find the connections automatically, click the
          // 'Auto-Fill' button between the Back and Next buttons.&quot;, &quot;Help For Current Step&quot;);
<span class="nc" id="L488">          break;</span>

        case PLAYERS_AND_ALLIANCES: // TODO: Verify message text.
          // showInfoMessage(&quot;Player Name: The name of the player. Examples: Russians, Germans, British,
          // Americans, Chinese, and Italians.\r\rPlayer Alliance: The name of the alliance that the player
          // is part of. Examples: Allies, and Axis.\r\rInitial Resources: The amount of resources(PUs) the
          // player begins with when the map is started.&quot;, &quot;Help For Current Step&quot;);
<span class="nc" id="L495">          break;</span>

        case UNIT_DEFINITIONS: // TODO: Verify message text.
          // showInfoMessage(&quot;Unit Name: The name of the unit. Examples: infantry, artillery, armour, fighter,
          // bomber, and transport.\r\rBuy Cost: The amount of resources it takes to buy the
          // unit.\r\rBuy Quantity: The amount of units to be placed with each purchase of the
          // unit.\r\rTo have the program automatically enter some of the commonly used units, click the
          // 'Auto-Fill' button between the Back and Next buttons.&quot;, &quot;Help For Current Step&quot;);
<span class="nc" id="L503">          break;</span>

        case GAMEPLAY_SEQUENCE:
<span class="nc" id="L506">          showInfoMessage(</span>
<span class="nc" id="L507">              &quot;Here is a list of all the available gameplay sequences with their class name and display name:\r\r initDelegate-InitializationDelegate-Initializing Delegates,\r bid-BidPurchaseDelegate-Bid Purchase,\r placeBid-BidPlaceDelegate-Bid Placement,\r tech-TechnologyDelegate-Research Technology,\r tech_Activation-TechActivationDelegate-Activate Technology,\r purchase-PurchaseDelegate-Purchase Units,\r move-MoveDelegate-Combat Move,\r battle-BattleDelegate-Combat,\r place-PlaceDelegate-Place Units,\r endTurn-EndTurnDelegate-Turn Complete,\r endRound-EndRoundDelegate-Round Complete&quot;,</span>
<span class="nc" id="L508">              &quot;List Of Available Gameplay Sequence Choices (As Of TripleA 1.0.3.4)&quot;);</span>
<span class="nc" id="L509">          break;</span>

        case PLAYER_SEQUENCE: // TODO: Verify message text.
          // showInfoMessage(&quot;Sequence Name: The name of the sequence. Examples: russianBid, germanBidPlace,
          // chineseTech, americanCombatMove, and germanPlace.\r\rGameplay Sequence: The name of the
          // Gameplay Sequence that the player sequence uses. Examples: bid, tech, move, place,
          // endTurn.\r\rPlayer: The name of the player that the Player Delegate is attached to. Examples:
          // Russians, Germans, Americans, and Chinese.\r\rMax Run Count: The maximum number of times the
          // Sequence can be used in the game. (You can set this value to 0 if you do not want the sequence to
          // have a run limit).\r\rTo have the program automatically enter the default Player Sequences,
          // click the 'Auto-Fill' button between the Back and Next buttons.&quot;, &quot;Help For Current Step&quot;);
<span class="nc" id="L520">          break;</span>

        case TECHNOLOGY_DEFINITIONS:
<span class="nc" id="L523">          showInfoMessage(</span>
<span class="nc" id="L524">              &quot;Here is a list of all the available technology types: heavyBomber, longRangeAir, jetPower, rocket, industrialTechnology, superSub, destroyerBombard, improvedArtillerySupport, paratroopers, increasedFactoryProduction, warBonds, mechanizedInfantry, aARadar, shipyards&quot;,</span>
<span class="nc" id="L525">              &quot;List Of Available Technology Choices (As Of TripleA 1.0.3.4)&quot;);</span>
<span class="nc" id="L526">          break;</span>

        case PRODUCTION_FRONTIERS: // TODO: Verify message text.
          // showInfoMessage(&quot;Unit Name: The name of the unit that is included in the production frontier.
          // Examples: infantry, artillery, and armour.\r\rTo have the program automatically add all the
          // units to the production frontier being shown, click the 'Auto-Fill' button between the Back and
          // Next buttons.\r\rNote: A production frontier is just a list of units that a player is allowed
          // to purchase.&quot;, &quot;Help For Current Step&quot;);
<span class="nc" id="L534">          break;</span>

        case UNIT_ATTACHMENTS:
<span class="nc" id="L537">          showInfoMessage(</span>
<span class="nc" id="L538">              &quot;Here is a list of all the available unit attachments: movement, attack, defense, isAir, isSea, isAA, isFactory, canBlitz, isSub, canBombard, isStrategicBomber, hitPoints, isDestroyer, isArtillery, isArtillerySupportable, isMarine, isInfantry, isAirTransportable, isInfantry, transportCapacity, transportCost, carrierCapacity, carrierCost&quot;,</span>
<span class="nc" id="L539">              &quot;List Of Available Unit Attachment Choices (As Of TripleA 1.0.3.4)&quot;);</span>
<span class="nc" id="L540">          break;</span>

        case TERRITORY_PRODUCTION: // TODO: Verify message text.
          // showInfoMessage(&quot;To change the production value of a territory, click on the territory and enter
          // the territory's new production value in the window that appears.&quot;, &quot;Help For Current Step&quot;);
<span class="nc" id="L545">          break;</span>

        case CANAL_DEFINITIONS: // TODO: Verify message text.
          // showInfoMessage(&quot;To add a new canal, click on both of the land territories that form the
          // canal(Touch the canal) and click yes when it asks for confirmation. To remove all the canals from
          // the map, right click on one of the territories and click 'Yes' to confirm.&quot;, &quot;Help For Current
          // Step&quot;);
<span class="nc" id="L552">          break;</span>

        case TERRITORY_OWNERSHIP: // TODO: Verify message text.
          // showInfoMessage(&quot;To change the initial owner of a territory, click on the territory and type in
          // its new owner when it asks for it.&quot;, &quot;Help For Current Step&quot;);
<span class="nc" id="L557">          break;</span>

        case UNIT_PLACEMENTS: // TODO: Verify message text.
          // showInfoMessage(&quot;To change the units that a territory begins with, click on the territory and use
          // the window that opens to set the territory's units. To do so, use the + and - buttons below each
          // unit's name to change the quantity of each unit in the territory. You can also edit the text in
          // the result textbox directly to change the territory units. Just type the name of each unit you
          // want to add, followed by ':', followed by the unit quantitiy: Example: 'infantry: 1, artillery: 3,
          // armour: 2, fighter: 1'.&quot;, &quot;Help For Current Step&quot;);
<span class="nc" id="L566">          break;</span>

        case GAME_SETTINGS:
<span class="nc" id="L569">          showInfoMessageOfAvailableGameSettingsChoices();</span>
<span class="nc" id="L570">          break;</span>

        case MAP_FINISHED:
<span class="nc" id="L573">          showInfoMessage(</span>
<span class="nc" id="L574">              &quot;The map notes can be entered in the textbox. You can enter plain text or html code. Then just click the '&quot;</span>
                  + BUTTON_LABEL_SAVE_MAP_XML
                  + &quot;' button, and save the file in the map's 'games' folder. (Create the 'games' folder if not already created)&quot;,
<span class="nc" id="L577">              &quot;Help For Current Step&quot;);</span>
          break;
      }
<span class="nc" id="L580">    });</span>
<span class="nc" id="L581">    southRightPanel.add(buttonAvailableChoices);</span>
<span class="nc" id="L582">  }</span>

  private void createButtonHelp() {
<span class="nc" id="L585">    buttonHelp = new JButton(&quot;Help&quot;);</span>
<span class="nc" id="L586">    buttonHelp.setMnemonic(KeyEvent.VK_H);</span>
<span class="nc" id="L587">    buttonHelp.setFont(MapXmlUIHelper.defaultMapXMLCreatorFont);</span>
<span class="nc" id="L588">    buttonHelp.addActionListener(e -&gt; {</span>
<span class="nc bnc" id="L589" title="All 17 branches missed.">      switch (currentStep) {</span>
        case MAP_PROPERTIES:
<span class="nc" id="L591">          showInfoMessage(</span>
<span class="nc" id="L592">              &quot;Map Name: The map name that is displayed in the New Game window in TripleA. Examples: Revised, Classic, Big World, and Great War\r\rMap Version: The version of the map's xml file. Examples: 0.0.1, 1.0.0.1, and 1.1\r\rResource Name: The name of the resource used in the map. Resources can be thought of as buying tokens or currency used to buy units, technology, etc. 'IPCs' have recently been replaced by 'PUs'. 'IPCs' will no longer work as the map resource. \r\rMap Image Location: The location of the map image. Example: C:/My Maps/Sleeping Giant/full_map.png\r\rMap Centers File: The location of the centers file produced by the 'Center Picker' program. The centers file is used to automatically add the map's territories. Example: C:/My Maps/Sleeping Giant/centers.txt\r\rWater Territory Filter: An optional setting that makes the program automatically apply the 'Is Water' property to every territory that contains the filter text. Examples: SZ, Sea Zone, Pacific, and Atlantic.&quot;,</span>
<span class="nc" id="L593">              &quot;Help For Current Step&quot;);</span>
<span class="nc" id="L594">          break;</span>

        case TERRITORY_DEFINITIONS: // showInfoMessage(&quot;To add a new territory, click somewhere on the map and enter a
                                    // name for the
          // territory in the window that appears. \r If you want to change the properties of a territory,
          // left click on it and answer each question. The color of the territory label changes for each
          // property that is applies. If you want to remove a territory label, right click on it and click yes
          // when it asks for confirmation.&quot;, &quot;Help For Current Step&quot;);
<span class="nc" id="L602">          showInfoMessage(</span>
<span class="nc" id="L603">              &quot;Right click to rename a territory. \r If you want to change the properties of a territory, left click on it. \r The color of the territory label changes for each property that is applied.&quot;,</span>
<span class="nc" id="L604">              &quot;Help For Current Step&quot;);</span>
<span class="nc" id="L605">          break;</span>

        case TERRITORY_CONNECTIONS:
<span class="nc" id="L608">          showInfoMessage(</span>
<span class="nc" id="L609">              &quot;To add a connection between two territories, click on the first territory in the connection and then the second. To remove all the connections from a certain territory, right click on it and click yes.\r\rNote: To have the program find the connections automatically, click the 'Auto-Fill' button between the Back and Next buttons.&quot;,</span>
<span class="nc" id="L610">              &quot;Help For Current Step&quot;);</span>
<span class="nc" id="L611">          break;</span>

        case PLAYERS_AND_ALLIANCES:
<span class="nc" id="L614">          showInfoMessage(</span>
<span class="nc" id="L615">              &quot;Player Name: The name of the player. Examples: Russians, Germans, British, Americans, Chinese, and Italians.\r\rPlayer Alliance: The name of the alliance that the player is part of. Examples: Allies, and Axis.\r\rInitial Resources: The amount of resources(PUs) the player begins with when the map is started.&quot;,</span>
<span class="nc" id="L616">              &quot;Help For Current Step&quot;);</span>
<span class="nc" id="L617">          break;</span>

        case UNIT_DEFINITIONS:
<span class="nc" id="L620">          showInfoMessage(</span>
<span class="nc" id="L621">              &quot;Unit Name: The name of the unit. Examples: infantry, artillery, armour, fighter, bomber, and transport.\r\rBuy Cost: The amount of resources it takes to buy the unit.\r\rBuy Quantity: The amount of units to be placed with each purchase of the unit.\r\rTo have the program automatically enter some of the commonly used units, click the 'Auto-Fill' button between the Back and Next buttons.&quot;,</span>
<span class="nc" id="L622">              &quot;Help For Current Step&quot;);</span>
<span class="nc" id="L623">          break;</span>

        case GAMEPLAY_SEQUENCE:
<span class="nc" id="L626">          showInfoMessage(</span>
<span class="nc" id="L627">              &quot;Sequence Name: The name of the sequence. Examples(Typical): tech, techActivation, battle, move, place, purchase, endTurn, placeBid, bid.\r\rClass Name: The name of the java delegate. Examples(Typical): TechnologyDelegate, TechActivationDelegate, BattleDelegate, MoveDelegate, PlaceDelegate, PurchaseDelegate, EndTurnDelegate, BidPlaceDelegate, BidPurchaseDelegate.\r\rDisplay: The text displayed for the delegate in TripleA. Examples(Typical): Research Technology, Activate Technology, Combat, Combat Move, Place Units, Purchase Units, Turn Complete, Bid Placement, and Bid Purchase\r\rTo have the program automatically enter the default Gameplay Sequences, click the 'Auto-Fill' button between the Back and Next buttons.&quot;,</span>
<span class="nc" id="L628">              &quot;Help For Current Step&quot;);</span>
<span class="nc" id="L629">          break;</span>

        case PLAYER_SEQUENCE:
<span class="nc" id="L632">          showInfoMessage(</span>
<span class="nc" id="L633">              &quot;Sequence Name: The name of the sequence. Examples: russianBid, germanBidPlace, chineseTech, americanCombatMove, and germanPlace.\r\rGameplay Sequence: The name of the Gameplay Sequence that the player sequence uses. Examples: bid, tech, move, place, endTurn.\r\rPlayer: The name of the player that the Player Delegate is attached to. Examples: Russians, Germans, Americans, and Chinese.\r\rMax Run Count: The maximum number of times the Sequence can be used in the game. (You can set this value to 0 if you do not want the sequence to have a run limit).\r\rTo have the program automatically enter the default Player Sequences, click the 'Auto-Fill' button between the Back and Next buttons.&quot;,</span>
<span class="nc" id="L634">              &quot;Help For Current Step&quot;);</span>
<span class="nc" id="L635">          break;</span>

        case TECHNOLOGY_DEFINITIONS:
<span class="nc" id="L638">          showInfoMessage(</span>
<span class="nc" id="L639">              &quot;Technology Name: The name of the technology that can be researched and unlocked by the player. Examples(Typical): heavyBomber, jetPower, industrialTechnology, superSub, rocket, and longRangeAir.\r\rPlayer: The name of the player that is able to research the technology. Examples: Russians, Germans, Americans, and Chinese.\r\rAlready Enabled: Determines if the technology should be unlocked for the selected player when the game first starts.\r\rTo have the program automatically enter some of the commonly used technologies, click the 'Auto-Fill' button between the Back and Next buttons.&quot;,</span>
<span class="nc" id="L640">              &quot;Help For Current Step&quot;);</span>
<span class="nc" id="L641">          break;</span>

        case PRODUCTION_FRONTIERS:
<span class="nc" id="L644">          showInfoMessage(</span>
<span class="nc" id="L645">              &quot;Unit Name: The name of the unit that is included in the production frontier. Examples: infantry, artillery, and armour.\r\rTo have the program automatically add all the units to the production frontier being shown, click the 'Auto-Fill' button between the Back and Next buttons.\r\rNote: A production frontier is just a list of units that a player is allowed to purchase.&quot;,</span>
<span class="nc" id="L646">              &quot;Help For Current Step&quot;);</span>
<span class="nc" id="L647">          break;</span>

        case UNIT_ATTACHMENTS:
<span class="nc" id="L650">          showInfoMessage(</span>
<span class="nc" id="L651">              &quot;Attachment Name: The name of the unit attachment that is applied to the unit. Examples: movement, attack, defense, isAir, isSea, and isStrategicBomber.\r\rValue: The attachment value. Examples: True, False, 1, 2\r\rTo have the program automatically enter the default attachments for the units that are commonly used, click the 'Auto-Fill' button between the Back and Next buttons.&quot;,</span>
<span class="nc" id="L652">              &quot;Help For Current Step&quot;);</span>
<span class="nc" id="L653">          break;</span>

        case TERRITORY_PRODUCTION:
<span class="nc" id="L656">          showInfoMessage(</span>
<span class="nc" id="L657">              &quot;To change the production value of a territory, click on the territory and enter the territory's new production value in the window that appears.&quot;,</span>
<span class="nc" id="L658">              &quot;Help For Current Step&quot;);</span>
<span class="nc" id="L659">          break;</span>

        case CANAL_DEFINITIONS:
<span class="nc" id="L662">          showInfoMessage(</span>
<span class="nc" id="L663">              &quot;To add a new canal, click on both of the land territories that form the canal(Touch the canal) and click yes when it asks for confirmation. To remove all the canals from the map, right click on one of the territories and click 'Yes' to confirm.&quot;,</span>
<span class="nc" id="L664">              &quot;Help For Current Step&quot;);</span>
<span class="nc" id="L665">          break;</span>

        case TERRITORY_OWNERSHIP:
<span class="nc" id="L668">          showInfoMessage(</span>
<span class="nc" id="L669">              &quot;To change the initial owner of a territory, click on the territory and type in its new owner when it asks for it.&quot;,</span>
<span class="nc" id="L670">              &quot;Help For Current Step&quot;);</span>
<span class="nc" id="L671">          break;</span>

        case UNIT_PLACEMENTS:
<span class="nc" id="L674">          showInfoMessage(</span>
<span class="nc" id="L675">              &quot;To change the units that a territory begins with, click on the territory and use the window that opens to set the territory's units. To do so, use the + and - buttons below each unit's name to change the quantity of each unit in the territory. You can also edit the text in the result textbox directly to change the territory units. Just type the name of each unit you want to add, followed by ':', followed by the unit quantitiy: Example: 'infantry: 1, artillery: 3, armour: 2, fighter: 1'.&quot;,</span>
<span class="nc" id="L676">              &quot;Help For Current Step&quot;);</span>
<span class="nc" id="L677">          break;</span>

        case GAME_SETTINGS:
<span class="nc" id="L680">          showInfoMessage(</span>
<span class="nc" id="L681">              &quot;Setting Name: The name of the setting that is applied to the map. Examples: Always on AA, Two hit battleship, and Japanese bid.\r\rValue: The value of the game setting. Examples: true, false, 0, 5, 32.\r\rEditable: Whether players are allowed to change the value of the setting when the map is being started.\r\rMin. N. (Optional): The lowest number that the value can be set to when the user sets the game options in TripleA. Only change this if the setting is a number.\r\rMax. N.(Optional): The highest number that the value can be set to when the user sets the game options in TripleA. Only change this if the setting is a number.\r\rTo have the program automatically enter some of the commonly used Game Settings, click the 'Auto-Fill' button between the Back and Next buttons.&quot;,</span>
<span class="nc" id="L682">              &quot;Help For Current Step&quot;);</span>
<span class="nc" id="L683">          break;</span>

        case MAP_FINISHED:
<span class="nc" id="L686">          showInfoMessage(</span>
<span class="nc" id="L687">              &quot;The map notes can be entered in the textbox. You can enter plain text or html code. Then just click the 'Save Map To File' button, and save the file in the map's 'games' folder. (Create the 'games' folder if not already created)&quot;,</span>
<span class="nc" id="L688">              &quot;Help For Current Step&quot;);</span>
          break;
      }
<span class="nc" id="L691">    });</span>
<span class="nc" id="L692">  }</span>

  /**
   *
   */
  private void addSouthCenterPanelButtons() {
<span class="nc" id="L698">    buttonBack = new JButton(&quot;Back&quot;);</span>
<span class="nc" id="L699">    buttonBack.setMnemonic(KeyEvent.VK_B);</span>
<span class="nc" id="L700">    buttonBack.setFont(MapXmlUIHelper.defaultMapXMLCreatorFont);</span>
<span class="nc" id="L701">    buttonBack.addActionListener(e -&gt; {</span>
<span class="nc" id="L702">      goToStep(getPrevGameStepTo(currentStep));</span>
<span class="nc" id="L703">      invokeLaterRepaintActionPanel();</span>
<span class="nc" id="L704">    });</span>
<span class="nc" id="L705">    southCenterPanel.add(buttonBack);</span>

<span class="nc" id="L707">    autoFillButton = MapXmlUIHelper.createButton(&quot;Auto-Fill&quot;, KeyEvent.VK_A);</span>
<span class="nc" id="L708">    autoFillButton.setMinimumSize(new Dimension(50, 23));</span>
<span class="nc" id="L709">    autoFillButton.setMaximumSize(new Dimension(50, 23));</span>
<span class="nc" id="L710">    southCenterPanel.add(autoFillButton);</span>

<span class="nc" id="L712">    nextButton = MapXmlUIHelper.createButton(&quot;Next&quot;, KeyEvent.VK_N, e -&gt; {</span>
<span class="nc" id="L713">      goToStep(getNextGameStepTo(currentStep));</span>
<span class="nc" id="L714">      invokeLaterRepaintActionPanel();</span>
<span class="nc" id="L715">    });</span>
<span class="nc" id="L716">    southCenterPanel.add(nextButton);</span>
<span class="nc" id="L717">  }</span>

  /**
   *
   */
  private void invokeLaterRepaintActionPanel() {
<span class="nc" id="L723">    SwingUtilities.invokeLater(() -&gt; {</span>
<span class="nc" id="L724">      actionPanel.validate();</span>
<span class="nc" id="L725">      actionPanel.repaint();</span>
<span class="nc" id="L726">    });</span>
<span class="nc" id="L727">  }</span>

  private void showInfoMessageOfAvailableGameSettingsChoices() {
    /*
     * Build alphabetically sorted table in HTML of the setting names
     * in which the first letter is displayed bigger in case it is
     * different to the previous first letter to improve readability
     */
<span class="nc" id="L735">    final String[] settings = GameSettingsPanel.allSettings.split(&quot;, &quot;);</span>
<span class="nc" id="L736">    Arrays.sort(settings);</span>
<span class="nc" id="L737">    final StringBuilder sb = new StringBuilder();</span>
<span class="nc" id="L738">    sb.append(</span>
<span class="nc" id="L739">        &quot;&lt;html&gt;Here is a list of all the available game settings:&lt;table border=0&gt;&lt;tr&gt;&lt;td&gt;&lt;table border=0&gt;&quot;);</span>
<span class="nc" id="L740">    int settingNr = 1;</span>
<span class="nc" id="L741">    char lastFirstLetteretter = 'z';</span>
<span class="nc" id="L742">    final int third_size_setting = (settings.length + 2) / 3;</span>
<span class="nc bnc" id="L743" title="All 2 branches missed.">    for (final String settingName : settings) {</span>
<span class="nc" id="L744">      final char firstLetter = settingName.charAt(0);</span>
<span class="nc bnc" id="L745" title="All 2 branches missed.">      if (firstLetter == lastFirstLetteretter) {</span>
<span class="nc" id="L746">        sb.append(&quot;&lt;tr&gt;&lt;td&gt;&quot;).append(settingName).append(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
<span class="nc" id="L747">      } else {</span>
<span class="nc" id="L748">        sb.append(&quot;&lt;tr&gt;&lt;td&gt;&lt;big&gt;&quot;).append(firstLetter).append(&quot;&lt;/big&gt;&quot;).append(settingName.substring(1))</span>
<span class="nc" id="L749">            .append(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);</span>
      }
<span class="nc" id="L751">      lastFirstLetteretter = firstLetter;</span>
<span class="nc bnc" id="L752" title="All 2 branches missed.">      if (settingNr % third_size_setting == 0) {</span>
<span class="nc" id="L753">        sb.append(&quot;&lt;/table&gt;&lt;/td&gt;&lt;td&gt;&lt;table border=0&gt;&quot;);</span>
      }
<span class="nc" id="L755">      ++settingNr;</span>
    }
<span class="nc" id="L757">    sb.append(&quot;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/html&gt;&quot;);</span>
<span class="nc" id="L758">    showInfoMessage(</span>
<span class="nc" id="L759">        sb.toString(), &quot;List Of Available Game Settings Choices&quot;);</span>
<span class="nc" id="L760">  }</span>

  private void showInfoMessage(final String message, final String title) {
<span class="nc" id="L763">    JOptionPane.showMessageDialog(null, message, title, JOptionPane.INFORMATION_MESSAGE);</span>
<span class="nc" id="L764">  }</span>

  private void setupMainPanel(final JPanel panel) {
<span class="nc" id="L767">    mainPanel.removeAll();</span>
<span class="nc" id="L768">    mainPanel.setLayout(new BorderLayout());</span>
<span class="nc" id="L769">    panel.setBorder(new MatteBorder(1, 0, 1, 1, Color.DARK_GRAY));</span>
<span class="nc" id="L770">    mainPanel.add(panel, BorderLayout.CENTER);</span>
<span class="nc" id="L771">    validateAndRepaint();</span>
<span class="nc" id="L772">  }</span>

  void validateAndRepaint() {
<span class="nc bnc" id="L775" title="All 2 branches missed.">    if (!SwingUtilities.isEventDispatchThread()) {</span>
<span class="nc" id="L776">      SwingUtilities.invokeLater(() -&gt; validateAndRepaint());</span>
<span class="nc" id="L777">      return;</span>
    }
<span class="nc" id="L779">    mainPanel.revalidate();</span>
<span class="nc" id="L780">    mainPanel.repaint();</span>
<span class="nc" id="L781">    this.validate();</span>
<span class="nc" id="L782">    this.repaint();</span>
<span class="nc" id="L783">  }</span>


<span class="nc" id="L786">  final private String stepLabelFontName = MapXmlUIHelper.defaultMapXMLCreatorFontName;</span>
<span class="nc" id="L787">  final private Font stepLabelFontDefault = new Font(stepLabelFontName, Font.PLAIN, 13);</span>
<span class="nc" id="L788">  final private Font stepLabelFontHighlighted = new Font(stepLabelFontName, Font.BOLD, 13);</span>

  private void goToStep(final GameStep step) {
<span class="nc bnc" id="L791" title="All 2 branches missed.">    if (currentStep != step) {</span>
<span class="nc" id="L792">      final GameStepLabel stepLabelOld = stepList.get(currentStep.ordinal());</span>
<span class="nc" id="L793">      stepLabelOld.setFont(stepLabelFontDefault);</span>
<span class="nc" id="L794">      stepLabelOld.repaint();</span>
    }

<span class="nc bnc" id="L797" title="All 2 branches missed.">    if (step.ordinal() &lt; stepList.size()) {</span>
<span class="nc" id="L798">      currentStep = step;</span>
<span class="nc bnc" id="L799" title="All 2 branches missed.">      if (step.ordinal() &gt; highestStep.ordinal()) {</span>
<span class="nc" id="L800">        highestStep = step;</span>
      }
<span class="nc" id="L802">      layoutStepActionPanel();</span>

<span class="nc" id="L804">      final GameStepLabel stepLabelNew = stepList.get(step.ordinal());</span>
<span class="nc" id="L805">      stepLabelNew.setFont(stepLabelFontHighlighted);</span>
<span class="nc" id="L806">      stepLabelNew.repaint();</span>

<span class="nc" id="L808">      setStepTitleLabelTextFromStepLabel(stepLabelNew);</span>

<span class="nc bnc" id="L810" title="All 2 branches missed.">      if (currentStep.ordinal() + 1 == stepList.size()) {</span>
<span class="nc" id="L811">        nextButton.setEnabled(false);</span>
<span class="nc" id="L812">      } else {</span>
<span class="nc" id="L813">        nextButton.setEnabled(true);</span>
      }

<span class="nc bnc" id="L816" title="All 2 branches missed.">      if (step != GAME_STEP_FIRST) {</span>
<span class="nc" id="L817">        buttonBack.setEnabled(true);</span>
<span class="nc" id="L818">      } else {</span>
<span class="nc" id="L819">        buttonBack.setEnabled(false);</span>
      }
    }
<span class="nc" id="L822">  }</span>

  protected void setStepTitleLabelTextFromStepLabel(final JLabel stepLabel) {
<span class="nc" id="L825">    String title = stepLabel.getText();</span>
<span class="nc" id="L826">    final String titleSep = &quot;: &quot;;</span>
<span class="nc" id="L827">    final int titleSepPos = title.indexOf(titleSep);</span>
<span class="nc" id="L828">    title = title.substring(titleSepPos + titleSep.length(), title.length());</span>
<span class="nc" id="L829">    stepTitleLabel.setText(title);</span>
<span class="nc" id="L830">  }</span>

  public void setAutoFillAction(final AbstractAction action) {
<span class="nc bnc" id="L833" title="All 2 branches missed.">    for (final ActionListener actionListener : autoFillButton.getActionListeners()) {</span>
<span class="nc" id="L834">      autoFillButton.removeActionListener(actionListener);</span>
    }
<span class="nc" id="L836">    autoFillButton.addActionListener(action);</span>
<span class="nc" id="L837">    autoFillButton.setEnabled(true);</span>
<span class="nc" id="L838">    SwingUtilities.invokeLater(() -&gt; autoFillButton.repaint());</span>
<span class="nc" id="L839">  }</span>

  private void layoutStepActionPanel() {
<span class="nc" id="L842">    stepActionPanel.removeAll();</span>
<span class="nc" id="L843">    autoFillButton.setEnabled(false);</span>
<span class="nc bnc" id="L844" title="All 17 branches missed.">    switch (currentStep) {</span>

      case MAP_PROPERTIES:
<span class="nc" id="L847">        MapPropertiesPanel.layout(this);</span>
<span class="nc" id="L848">        break;</span>

      case TERRITORY_DEFINITIONS:
<span class="nc" id="L851">        TerritoryDefinitionsPanel.layout(this);</span>
<span class="nc" id="L852">        break;</span>

      case TERRITORY_CONNECTIONS:
<span class="nc" id="L855">        TerritoryConnectionsPanel.layout(this);</span>
<span class="nc" id="L856">        break;</span>
      case PLAYERS_AND_ALLIANCES:
<span class="nc" id="L858">        PlayerAndAlliancesPanel.layout(this);</span>
<span class="nc" id="L859">        break;</span>
      case UNIT_DEFINITIONS:
<span class="nc" id="L861">        UnitDefinitionsPanel.layout(this);</span>
<span class="nc" id="L862">        break;</span>

      case GAMEPLAY_SEQUENCE:
<span class="nc" id="L865">        GameSequencePanel.layout(this);</span>
<span class="nc" id="L866">        break;</span>

      case PLAYER_SEQUENCE:
<span class="nc" id="L869">        PlayerSequencePanel.layout(this);</span>
<span class="nc" id="L870">        break;</span>

      case TECHNOLOGY_DEFINITIONS:
<span class="nc" id="L873">        TechnologyDefinitionsPanel.layout(this);</span>
<span class="nc" id="L874">        break;</span>

      case PRODUCTION_FRONTIERS:
<span class="nc" id="L877">        layoutTabbedPaneWith(MapXmlHelper.getProductionFrontiersMap().keySet());</span>
<span class="nc" id="L878">        break;</span>

      case UNIT_ATTACHMENTS:
<span class="nc" id="L881">        layoutTabbedPaneWith(MapXmlHelper.getUnitDefinitionsMap().keySet());</span>
<span class="nc" id="L882">        break;</span>

      case TERRITORY_PRODUCTION:
<span class="nc" id="L885">        TerritoryProductionPanel.layout(this);</span>
<span class="nc" id="L886">        break;</span>

      case CANAL_DEFINITIONS:
<span class="nc" id="L889">        CanalDefinitionsPanel.layout(this);</span>
<span class="nc" id="L890">        break;</span>

      case TERRITORY_OWNERSHIP:
<span class="nc" id="L893">        TerritoryOwnershipPanel.layout(this);</span>
<span class="nc" id="L894">        break;</span>

      case UNIT_PLACEMENTS:
<span class="nc" id="L897">        UnitPlacementsPanel.layout(this);</span>
<span class="nc" id="L898">        break;</span>

      case GAME_SETTINGS:
<span class="nc" id="L901">        GameSettingsPanel.layout(this);</span>
<span class="nc" id="L902">        break;</span>


      case MAP_FINISHED:
<span class="nc" id="L906">        layoutNotesPanel();</span>
<span class="nc" id="L907">        break;</span>

      default:
        break;
    }
<span class="nc" id="L912">    final JFrame me = this;</span>
<span class="nc" id="L913">    SwingUtilities.invokeLater(() -&gt; {</span>
<span class="nc" id="L914">      me.pack();</span>
<span class="nc" id="L915">      stepActionPanel.revalidate();</span>
<span class="nc" id="L916">      stepActionPanel.repaint();</span>
<span class="nc" id="L917">    });</span>
<span class="nc" id="L918">  }</span>


  public void setAutoFillActionListener(final ActionListener autoFillActionListener) {
<span class="nc bnc" id="L922" title="All 2 branches missed.">    if (autoFillActionListener == null) {</span>
<span class="nc" id="L923">      autoFillButton.setEnabled(false);</span>
<span class="nc" id="L924">    } else {</span>
<span class="nc" id="L925">      autoFillButton.setEnabled(true);</span>
<span class="nc bnc" id="L926" title="All 2 branches missed.">      for (final ActionListener curr_actionListener : autoFillButton.getActionListeners()) {</span>
<span class="nc" id="L927">        autoFillButton.removeActionListener(curr_actionListener);</span>
      }
<span class="nc" id="L929">      autoFillButton.addActionListener(autoFillActionListener);</span>
    }
<span class="nc" id="L931">  }</span>

  protected void layoutNotesPanel() {
<span class="nc" id="L934">    stepActionPanel.setLayout(new GridBagLayout());</span>

<span class="nc" id="L936">    final JTextArea taNotes = new JTextArea(MapXmlHelper.getNotes());</span>
<span class="nc" id="L937">    taNotes.addFocusListener(FocusListenerFocusLost.withAction(() -&gt; {</span>
<span class="nc bnc" id="L938" title="All 2 branches missed.">      if (!MapXmlHelper.getNotes().equals(taNotes.getText())) {</span>
<span class="nc" id="L939">        MapXmlHelper.setNotes(taNotes.getText().trim());</span>
      }
<span class="nc" id="L941">    }));</span>
<span class="nc" id="L942">    final JScrollPane spTaNotes = new JScrollPane(taNotes);</span>

<span class="nc" id="L944">    final Dimension size = stepActionPanel.getSize();</span>
<span class="nc" id="L945">    size.height -= 100;</span>
<span class="nc" id="L946">    spTaNotes.setMinimumSize(size);</span>

<span class="nc" id="L948">    final GridBagConstraints gridBadConstLabelNotesRow = new GridBagConstraints();</span>
<span class="nc" id="L949">    gridBadConstLabelNotesRow.insets = new Insets(0, 0, 5, 0);</span>
<span class="nc" id="L950">    gridBadConstLabelNotesRow.gridy = 0;</span>
<span class="nc" id="L951">    gridBadConstLabelNotesRow.gridx = 0;</span>
<span class="nc" id="L952">    gridBadConstLabelNotesRow.anchor = GridBagConstraints.NORTH;</span>
<span class="nc" id="L953">    gridBadConstLabelNotesRow.weightx = 1.0;</span>
<span class="nc" id="L954">    gridBadConstLabelNotesRow.weighty = 1.0;</span>
<span class="nc" id="L955">    gridBadConstLabelNotesRow.gridwidth = 3;</span>
<span class="nc" id="L956">    stepActionPanel.add(spTaNotes, gridBadConstLabelNotesRow);</span>

<span class="nc" id="L958">    final GridBagConstraints gridBadConstButtonPreviewHTMLRow = (GridBagConstraints) gridBadConstLabelNotesRow.clone();</span>
<span class="nc" id="L959">    gridBadConstButtonPreviewHTMLRow.weighty = 0.0;</span>
<span class="nc" id="L960">    gridBadConstButtonPreviewHTMLRow.insets = new Insets(0, 0, 0, 0);</span>
<span class="nc" id="L961">    gridBadConstButtonPreviewHTMLRow.gridwidth = 1;</span>
<span class="nc" id="L962">    gridBadConstButtonPreviewHTMLRow.gridx = 1;</span>
<span class="nc" id="L963">    gridBadConstButtonPreviewHTMLRow.gridy = 1;</span>

<span class="nc" id="L965">    final JButton buttonPreviewHTML = new JButton(&quot;Preview HTML&quot;);</span>
<span class="nc" id="L966">    buttonPreviewHTML.setPreferredSize(new Dimension(300, 30));</span>
<span class="nc" id="L967">    buttonPreviewHTML.setAction(SwingAction.of(&quot;Preview HTML&quot;, e -&gt; showHTML(MapXmlHelper.getNotes(), &quot;HTML Preview&quot;)));</span>
<span class="nc" id="L968">    stepActionPanel.add(buttonPreviewHTML, gridBadConstButtonPreviewHTMLRow);</span>

<span class="nc" id="L970">    final GridBagConstraints gridBadConstLabelCongratsRow =</span>
<span class="nc" id="L971">        (GridBagConstraints) gridBadConstButtonPreviewHTMLRow.clone();</span>
<span class="nc" id="L972">    gridBadConstLabelCongratsRow.gridy = 2;</span>
<span class="nc" id="L973">    stepActionPanel.add(new JLabel(&quot;&lt;html&gt;&lt;big&gt;Congratulation!&lt;/big&gt;&lt;/html&gt;&quot;), gridBadConstLabelCongratsRow);</span>

<span class="nc" id="L975">    final GridBagConstraints gridBadConstLabelAllCompletedRow =</span>
<span class="nc" id="L976">        (GridBagConstraints) gridBadConstButtonPreviewHTMLRow.clone();</span>
<span class="nc" id="L977">    gridBadConstLabelAllCompletedRow.gridy = 3;</span>
<span class="nc" id="L978">    stepActionPanel.add(</span>
<span class="nc" id="L979">        new JLabel(&quot;&lt;html&gt;&lt;nobr&gt;You have completed all the steps for creating the map XML.&lt;/nobr&gt;&lt;/html&gt;&quot;),</span>
<span class="nc" id="L980">        gridBadConstLabelAllCompletedRow);</span>

<span class="nc" id="L982">    final JButton buttonSave = new JButton(&quot;Save Entries to XML&quot;);</span>
<span class="nc" id="L983">    buttonSave.setPreferredSize(new Dimension(600, 35));</span>
<span class="nc" id="L984">    buttonSave.setAction(SwingAction.of(BUTTON_LABEL_SAVE_MAP_XML, e -&gt; MapXmlCreator.saveXML()));</span>
<span class="nc" id="L985">    final GridBagConstraints gridBadConstButtonSaveRow = (GridBagConstraints) gridBadConstButtonPreviewHTMLRow.clone();</span>
<span class="nc" id="L986">    gridBadConstButtonSaveRow.insets = new Insets(5, 0, 0, 0);</span>
<span class="nc" id="L987">    gridBadConstButtonSaveRow.gridy = 4;</span>
<span class="nc" id="L988">    stepActionPanel.add(buttonSave, gridBadConstButtonSaveRow);</span>
<span class="nc" id="L989">  }</span>

  protected void layoutTabbedPaneWith(final Set&lt;String&gt; keySet) {
<span class="nc" id="L992">    stepActionPanel.setLayout(new BorderLayout());</span>
<span class="nc" id="L993">    final JTabbedPane tabbedPane = new JTabbedPane(JTabbedPane.SCROLL_TAB_LAYOUT);</span>
<span class="nc bnc" id="L994" title="All 2 branches missed.">    for (final String key : keySet) {</span>
<span class="nc" id="L995">      final JPanel innerTabPane = new JPanel();</span>
<span class="nc" id="L996">      tabbedPane.addTab(key, innerTabPane);</span>
<span class="nc" id="L997">      ProductionFrontiersPanel.layout(this, innerTabPane, key);</span>
    }
<span class="nc" id="L999">    stepActionPanel.add(tabbedPane, BorderLayout.CENTER);</span>
<span class="nc" id="L1000">  }</span>

  public void showHTML(final String htmlString, final String title) {
<span class="nc" id="L1003">    SwingUtilities.invokeLater(new Runnable() {</span>
      @Override
      public void run() {

<span class="nc" id="L1007">        final JEditorPane jEditorPane = new JEditorPane();</span>
<span class="nc" id="L1008">        jEditorPane.setEditable(false);</span>

<span class="nc" id="L1010">        final JScrollPane scrollPane = new JScrollPane(jEditorPane);</span>

<span class="nc" id="L1012">        final HTMLEditorKit kit = new HTMLEditorKit();</span>
<span class="nc" id="L1013">        jEditorPane.setEditorKit(kit);</span>

<span class="nc" id="L1015">        final Document doc = kit.createDefaultDocument();</span>
<span class="nc" id="L1016">        jEditorPane.setDocument(doc);</span>
<span class="nc" id="L1017">        jEditorPane.setText(htmlString);</span>

<span class="nc" id="L1019">        final JFrame j = new JFrame(title);</span>
<span class="nc" id="L1020">        j.getContentPane().add(scrollPane, BorderLayout.CENTER);</span>

        // make it easy to close the application
<span class="nc" id="L1023">        j.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span>

        // display the frame
<span class="nc" id="L1026">        j.setSize(new Dimension(800, 600));</span>

        // center the jframe, then make it visible
<span class="nc" id="L1029">        j.setLocationRelativeTo(null);</span>
<span class="nc" id="L1030">        j.setVisible(true);</span>
<span class="nc" id="L1031">      }</span>
    });
<span class="nc" id="L1033">  }</span>

  static void saveXML() {
    try {
<span class="nc" id="L1037">      final String fileName =</span>
<span class="nc" id="L1038">          new FileSave(&quot;Where to Save the Game XML ?&quot;,</span>
<span class="nc" id="L1039">              MapXmlHelper.getXmlStringsMap().get(&quot;info_@name&quot;) + FILE_NAME_ENDING_XML,</span>
<span class="nc" id="L1040">              mapFolderLocation).getPathString();</span>
<span class="nc bnc" id="L1041" title="All 2 branches missed.">      if (fileName == null) {</span>
<span class="nc" id="L1042">        return;</span>
      }

      // write the content into xml file
<span class="nc" id="L1046">      final TransformerFactory transformerFactory = TransformerFactory.newInstance();</span>
<span class="nc" id="L1047">      final Transformer transformer = transformerFactory.newTransformer();</span>
<span class="nc" id="L1048">      transformer.setOutputProperty(&quot;{http://xml.apache.org/xslt}indent-amount&quot;, &quot;2&quot;);</span>
<span class="nc" id="L1049">      transformer.setOutputProperty(OutputKeys.INDENT, &quot;yes&quot;);</span>
<span class="nc" id="L1050">      transformer.setOutputProperty(OutputKeys.DOCTYPE_SYSTEM, GameParser.DTD_FILE_NAME);</span>
<span class="nc" id="L1051">      final DOMSource source = new DOMSource(MapXmlHelper.getXMLDocument());</span>
<span class="nc" id="L1052">      final File newFile = new File(fileName);</span>
<span class="nc" id="L1053">      final StreamResult result = new StreamResult(newFile);</span>

<span class="nc" id="L1055">      transformer.transform(source, result);</span>

<span class="nc" id="L1057">      Logger.getLogger(MapXmlCreator.MAP_XML_CREATOR_LOGGER_NAME).log(Level.INFO,</span>
<span class="nc" id="L1058">          &quot;Game XML written to &quot; + newFile.getCanonicalPath());</span>
<span class="nc" id="L1059">    } catch (final IOException | HeadlessException | TransformerException | ParserConfigurationException e) {</span>
<span class="nc" id="L1060">      ClientLogger.logQuietly(e);</span>
    }
<span class="nc" id="L1062">  }</span>


  /**
   * Log a message, with no arguments.
   * &lt;p&gt;
   * If the logger is currently enabled for the given message
   * level then the given message is forwarded to all the
   * registered output Handler objects.
   * &lt;p&gt;
   *
   * @param level One of the message level identifiers, e.g., SEVERE
   * @param msg The string message (or a key in the message catalog)
   */
  static public void log(final Level level, final String msg) {
<span class="nc" id="L1077">    getLogger().log(level, msg);</span>
<span class="nc" id="L1078">  }</span>

  static GameStep loadXML() {
<span class="nc" id="L1081">    final String gameXMLPath =</span>
<span class="nc" id="L1082">        MapXmlUIHelper.selectFile(&quot;Game XML File&quot;, MapXmlHelper.getMapXMLFile(), FILE_NAME_ENDING_XML).getPathString();</span>
<span class="nc" id="L1083">    MapXmlCreator.log(Level.INFO, &quot;Load Game XML from &quot; + gameXMLPath);</span>
    try {
<span class="nc" id="L1085">      return loadXmlFromFilePath(gameXMLPath);</span>
<span class="nc" id="L1086">    } catch (SAXException | IOException | ParserConfigurationException e) {</span>
<span class="nc" id="L1087">      ClientLogger.logError(&quot;Failed to load XML File: &quot; + gameXMLPath, e);</span>
<span class="nc" id="L1088">      return loadXML();</span>
    }
  }

  /**
   * @param gameXMLPath
   * @return
   * @throws FileNotFoundException
   * @throws SAXException
   * @throws IOException
   * @throws ParserConfigurationException
   */
  public static GameStep loadXmlFromFilePath(final String gameXMLPath)
      throws SAXException, IOException, ParserConfigurationException {
<span class="nc" id="L1102">    final FileInputStream in = new FileInputStream(gameXMLPath);</span>

    // parse using builder to get DOM representation of the XML file
<span class="nc" id="L1105">    final org.w3c.dom.Document dom = new GameParser(gameXMLPath).getDocument(in);</span>

<span class="nc" id="L1107">    GameStep goToStep = MapXmlHelper.parseValuesFromXML(dom);</span>

    // set map file, image file and map folder
<span class="nc" id="L1110">    MapXmlHelper.setMapXMLFile(new File(gameXMLPath));</span>
<span class="nc" id="L1111">    File mapFolder = MapXmlHelper.getMapXMLFile().getParentFile();</span>
<span class="nc bnc" id="L1112" title="All 2 branches missed.">    if (mapFolder.getName().equals(GameSelectorModel.DEFAULT_GAME_XML_DIRECTORY_NAME)) {</span>
<span class="nc" id="L1113">      mapFolder = mapFolder.getParentFile();</span>
    }
<span class="nc" id="L1115">    mapFolderLocation = mapFolder;</span>
<span class="nc" id="L1116">    final File[] imageFiles = mapFolderLocation.listFiles(new FilenameFilter() {</span>

      @Override
      public boolean accept(final File arg0, final String arg1) {
<span class="nc bnc" id="L1120" title="All 4 branches missed.">        return (arg1.endsWith(FILE_NAME_ENDING_GIF) || arg1.endsWith(FILE_NAME_ENDING_PNG));</span>
      }
    });
<span class="nc bnc" id="L1123" title="All 4 branches missed.">    if (imageFiles != null &amp;&amp; imageFiles.length == 1) {</span>
<span class="nc" id="L1124">      mapImageFile = imageFiles[0];</span>
<span class="nc" id="L1125">    } else {</span>
<span class="nc" id="L1126">      MapPropertiesPanel.selectMapImageFile();</span>
    }

<span class="nc" id="L1129">    final File fileGuess = new File(mapFolderLocation, FILE_NAME_CENTERS_TXT);</span>
<span class="nc bnc" id="L1130" title="All 4 branches missed.">    if (fileGuess != null &amp;&amp; fileGuess.exists()) {</span>
<span class="nc" id="L1131">      mapCentersFile = fileGuess;</span>
<span class="nc" id="L1132">    } else {</span>
<span class="nc" id="L1133">      MapPropertiesPanel.selectCentersFile();</span>
    }

<span class="nc bnc" id="L1136" title="All 4 branches missed.">    if (mapImageFile == null || mapCentersFile == null) {</span>
<span class="nc" id="L1137">      goToStep = GAME_STEP_FIRST;</span>
    }

<span class="nc" id="L1140">    ImageScrollPanePanel.polygonsInvalid = true;</span>

<span class="nc" id="L1142">    return goToStep;</span>
  }

  class GameStepLabel extends JLabel {
    private static final long serialVersionUID = -2034374214878411484L;
    private final GameStep gameStep;

    /**
     * Creates a &lt;code&gt;JLabel&lt;/code&gt; instance with the specified text.
     * The label is aligned against the leading edge of its display area,
     * and centered vertically.
     *
     * @param text The text to be displayed by the label.
     */
<span class="nc" id="L1156">    public GameStepLabel(final String text, final GameStep step) {</span>
<span class="nc" id="L1157">      super(text);</span>
<span class="nc" id="L1158">      gameStep = step;</span>
<span class="nc" id="L1159">      final GameStepLabel me = this;</span>
<span class="nc" id="L1160">      addMouseListener(new MouseListener() {</span>

        @Override
<span class="nc" id="L1163">        public void mouseReleased(final MouseEvent e) {}</span>

        @Override
<span class="nc" id="L1166">        public void mousePressed(final MouseEvent e) {}</span>

        @Override
        public void mouseExited(final MouseEvent e) {
<span class="nc bnc" id="L1170" title="All 2 branches missed.">          if (gameStep != currentStep) {</span>
<span class="nc" id="L1171">            me.setOpaque(false);</span>
<span class="nc" id="L1172">            me.setBackground(me.getBackground().darker().darker());</span>
<span class="nc" id="L1173">            me.updateUI();</span>
          }
<span class="nc" id="L1175">        }</span>

        @Override
        public void mouseEntered(final MouseEvent e) {
<span class="nc bnc" id="L1179" title="All 2 branches missed.">          if (gameStep != currentStep) {</span>
<span class="nc" id="L1180">            me.setOpaque(true);</span>
<span class="nc" id="L1181">            me.setBackground(me.getBackground().brighter().brighter());</span>
<span class="nc" id="L1182">            me.updateUI();</span>
          }
<span class="nc" id="L1184">        }</span>

        @Override
        public void mouseClicked(final MouseEvent e) {
<span class="nc" id="L1188">          me.requestFocus();</span>
<span class="nc bnc" id="L1189" title="All 2 branches missed.">          if (gameStep != currentStep</span>
<span class="nc bnc" id="L1190" title="All 4 branches missed.">              &amp;&amp; (!DynamicRowsPanel.me.isPresent() || DynamicRowsPanel.me.get().dataIsConsistent())) {</span>
<span class="nc" id="L1191">            me.setOpaque(false);</span>
<span class="nc" id="L1192">            goToStep(gameStep);</span>
          }
<span class="nc" id="L1194">        }</span>
      });
<span class="nc" id="L1196">    }</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span>test (25/nov/2016 10:16:58)</div></body></html>