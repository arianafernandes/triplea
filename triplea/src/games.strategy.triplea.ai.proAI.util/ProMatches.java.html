<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>ProMatches.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">test (25/nov/2016 10:16:58)</a> &gt; <a href="../../index.html" class="el_group">triplea</a> &gt; <a href="../index.html" class="el_bundle">src</a> &gt; <a href="index.source.html" class="el_package">games.strategy.triplea.ai.proAI.util</a> &gt; <span class="el_source">ProMatches.java</span></div><h1>ProMatches.java</h1><pre class="source lang-java linenums"><span class="nc" id="L1">package games.strategy.triplea.ai.proAI.util;</span>

import java.util.Collection;
import java.util.List;

import games.strategy.engine.data.GameData;
import games.strategy.engine.data.PlayerID;
import games.strategy.engine.data.Territory;
import games.strategy.engine.data.Unit;
import games.strategy.engine.data.UnitType;
import games.strategy.triplea.Properties;
import games.strategy.triplea.attachments.UnitAttachment;
import games.strategy.triplea.delegate.AbstractMoveDelegate;
import games.strategy.triplea.delegate.Matches;
import games.strategy.triplea.delegate.TerritoryEffectHelper;
import games.strategy.util.CompositeMatch;
import games.strategy.util.CompositeMatchAnd;
import games.strategy.util.CompositeMatchOr;
import games.strategy.util.Match;

/**
 * Pro AI matches.
 */
<span class="nc" id="L24">public class ProMatches {</span>

  public static Match&lt;Territory&gt; territoryCanLandAirUnits(final PlayerID player, final GameData data,
      final boolean isCombatMove, final List&lt;Territory&gt; enemyTerritories, final List&lt;Territory&gt; alliedTerritories) {
<span class="nc" id="L28">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L31">        final Match&lt;Territory&gt; match = new CompositeMatchOr&lt;&gt;(Matches.territoryIsInList(alliedTerritories),</span>
<span class="nc" id="L32">            new CompositeMatchAnd&lt;&gt;(Matches.airCanLandOnThisAlliedNonConqueredLandTerritory(player, data),</span>
<span class="nc" id="L33">                Matches.TerritoryIsPassableAndNotRestrictedAndOkByRelationships(player, data, isCombatMove, false,</span>
<span class="nc" id="L34">                    false, true, true),</span>
<span class="nc" id="L35">                Matches.territoryIsInList(enemyTerritories).invert()));</span>
<span class="nc" id="L36">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryCanMoveAirUnits(final PlayerID player, final GameData data,
      final boolean isCombatMove) {
<span class="nc" id="L43">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L46">        final Match&lt;Territory&gt; match = new CompositeMatchAnd&lt;&gt;(Matches.territoryDoesNotCostMoneyToEnter(data),</span>
<span class="nc" id="L47">            Matches.TerritoryIsPassableAndNotRestrictedAndOkByRelationships(player, data, isCombatMove, false, false,</span>
<span class="nc" id="L48">                true, false));</span>
<span class="nc" id="L49">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryCanPotentiallyMoveAirUnits(final PlayerID player, final GameData data,
      final boolean isCombatMove) {
<span class="nc" id="L56">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L59">        final Match&lt;Territory&gt; match = new CompositeMatchAnd&lt;&gt;(Matches.territoryDoesNotCostMoneyToEnter(data),</span>
<span class="nc" id="L60">            Matches.TerritoryIsPassableAndNotRestricted(player, data));</span>
<span class="nc" id="L61">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryCanMoveAirUnitsAndNoAA(final PlayerID player, final GameData data,
      final boolean isCombatMove) {
<span class="nc" id="L68">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L71">        final Match&lt;Territory&gt; match =</span>
<span class="nc" id="L72">            new CompositeMatchAnd&lt;&gt;(ProMatches.territoryCanMoveAirUnits(player, data, isCombatMove),</span>
<span class="nc" id="L73">                Matches.territoryHasEnemyAAforAnything(player, data).invert());</span>
<span class="nc" id="L74">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryCanMoveSpecificLandUnit(final PlayerID player, final GameData data,
      final boolean isCombatMove, final Unit u) {
<span class="nc" id="L81">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L84">        final Match&lt;Territory&gt; territoryMatch = new CompositeMatchAnd&lt;&gt;(Matches.territoryDoesNotCostMoneyToEnter(data),</span>
<span class="nc" id="L85">            Matches.TerritoryIsPassableAndNotRestrictedAndOkByRelationships(player, data, isCombatMove, true, false,</span>
<span class="nc" id="L86">                false, false));</span>
<span class="nc" id="L87">        final Match&lt;Unit&gt; unitMatch =</span>
<span class="nc" id="L88">            Matches.unitIsOfTypes(TerritoryEffectHelper.getUnitTypesForUnitsNotAllowedIntoTerritory(t)).invert();</span>
<span class="nc bnc" id="L89" title="All 4 branches missed.">        return territoryMatch.match(t) &amp;&amp; unitMatch.match(u);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryCanPotentiallyMoveSpecificLandUnit(final PlayerID player, final GameData data,
      final boolean isCombatMove, final Unit u) {
<span class="nc" id="L96">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L99">        final Match&lt;Territory&gt; territoryMatch = new CompositeMatchAnd&lt;&gt;(Matches.territoryDoesNotCostMoneyToEnter(data),</span>
<span class="nc" id="L100">            Matches.TerritoryIsPassableAndNotRestricted(player, data));</span>
<span class="nc" id="L101">        final Match&lt;Unit&gt; unitMatch =</span>
<span class="nc" id="L102">            Matches.unitIsOfTypes(TerritoryEffectHelper.getUnitTypesForUnitsNotAllowedIntoTerritory(t)).invert();</span>
<span class="nc bnc" id="L103" title="All 4 branches missed.">        return territoryMatch.match(t) &amp;&amp; unitMatch.match(u);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryCanMoveLandUnits(final PlayerID player, final GameData data,
      final boolean isCombatMove) {
<span class="nc" id="L110">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L113">        final Match&lt;Territory&gt; match = new CompositeMatchAnd&lt;&gt;(Matches.territoryDoesNotCostMoneyToEnter(data),</span>
<span class="nc" id="L114">            Matches.TerritoryIsPassableAndNotRestrictedAndOkByRelationships(player, data, isCombatMove, true, false,</span>
<span class="nc" id="L115">                false, false));</span>
<span class="nc" id="L116">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryCanPotentiallyMoveLandUnits(final PlayerID player, final GameData data,
      final boolean isCombatMove) {
<span class="nc" id="L123">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L126">        final Match&lt;Territory&gt; match = new CompositeMatchAnd&lt;&gt;(Matches.TerritoryIsLand,</span>
<span class="nc" id="L127">            Matches.territoryDoesNotCostMoneyToEnter(data), Matches.TerritoryIsPassableAndNotRestricted(player, data));</span>
<span class="nc" id="L128">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryCanMoveLandUnitsAndIsAllied(final PlayerID player, final GameData data) {
<span class="nc" id="L134">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L137">        final Match&lt;Territory&gt; match = new CompositeMatchAnd&lt;&gt;(Matches.isTerritoryAllied(player, data),</span>
<span class="nc" id="L138">            territoryCanMoveLandUnits(player, data, false));</span>
<span class="nc" id="L139">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryCanMoveLandUnitsThrough(final PlayerID player, final GameData data,
      final Unit u, final Territory startTerritory, final boolean isCombatMove,
      final List&lt;Territory&gt; enemyTerritories) {
<span class="nc" id="L147">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L150">        Match&lt;Territory&gt; match =</span>
<span class="nc" id="L151">            new CompositeMatchAnd&lt;&gt;(ProMatches.territoryCanMoveSpecificLandUnit(player, data, isCombatMove, u),</span>
<span class="nc" id="L152">                Matches.isTerritoryAllied(player, data), Matches.territoryHasNoEnemyUnits(player, data),</span>
<span class="nc" id="L153">                Matches.territoryIsInList(enemyTerritories).invert());</span>
<span class="nc bnc" id="L154" title="All 6 branches missed.">        if (isCombatMove &amp;&amp; Matches.UnitCanBlitz.match(u) &amp;&amp; TerritoryEffectHelper.unitKeepsBlitz(u, startTerritory)) {</span>
<span class="nc" id="L155">          final Match&lt;Territory&gt; alliedWithNoEnemiesMatch = new CompositeMatchAnd&lt;&gt;(</span>
<span class="nc" id="L156">              Matches.isTerritoryAllied(player, data), Matches.territoryHasNoEnemyUnits(player, data));</span>
<span class="nc" id="L157">          final Match&lt;Territory&gt; alliedOrBlitzableMatch =</span>
<span class="nc" id="L158">              new CompositeMatchOr&lt;&gt;(alliedWithNoEnemiesMatch, territoryIsBlitzable(player, data, u));</span>
<span class="nc" id="L159">          match = new CompositeMatchAnd&lt;&gt;(ProMatches.territoryCanMoveSpecificLandUnit(player, data, isCombatMove, u),</span>
<span class="nc" id="L160">              alliedOrBlitzableMatch, Matches.territoryIsInList(enemyTerritories).invert());</span>
        }
<span class="nc" id="L162">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryCanMoveLandUnitsThroughIgnoreEnemyUnits(final PlayerID player,
      final GameData data, final Unit u, final Territory startTerritory, final boolean isCombatMove,
      final List&lt;Territory&gt; blockedTerritories, final List&lt;Territory&gt; clearedTerritories) {
<span class="nc" id="L170">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L173">        Match&lt;Territory&gt; alliedMatch = new CompositeMatchOr&lt;&gt;(Matches.isTerritoryAllied(player, data),</span>
<span class="nc" id="L174">            Matches.territoryIsInList(clearedTerritories));</span>
<span class="nc bnc" id="L175" title="All 6 branches missed.">        if (isCombatMove &amp;&amp; Matches.UnitCanBlitz.match(u) &amp;&amp; TerritoryEffectHelper.unitKeepsBlitz(u, startTerritory)) {</span>
<span class="nc" id="L176">          alliedMatch = new CompositeMatchOr&lt;&gt;(Matches.isTerritoryAllied(player, data),</span>
<span class="nc" id="L177">              Matches.territoryIsInList(clearedTerritories), territoryIsBlitzable(player, data, u));</span>
        }
<span class="nc" id="L179">        final Match&lt;Territory&gt; match =</span>
<span class="nc" id="L180">            new CompositeMatchAnd&lt;&gt;(ProMatches.territoryCanMoveSpecificLandUnit(player, data, isCombatMove, u),</span>
<span class="nc" id="L181">                alliedMatch, Matches.territoryIsInList(blockedTerritories).invert());</span>
<span class="nc" id="L182">        return match.match(t);</span>
      }
    };
  }

  private static Match&lt;Territory&gt; territoryIsBlitzable(final PlayerID player, final GameData data, final Unit u) {
<span class="nc" id="L188">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc bnc" id="L191" title="All 4 branches missed.">        return Matches.TerritoryIsBlitzable(player, data).match(t) &amp;&amp; TerritoryEffectHelper.unitKeepsBlitz(u, t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryCanMoveSeaUnits(final PlayerID player, final GameData data,
      final boolean isCombatMove) {
<span class="nc" id="L198">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L201">        final boolean navalMayNotNonComIntoControlled =</span>
<span class="nc bnc" id="L202" title="All 4 branches missed.">            Properties.getWW2V2(data) || Properties.getNavalUnitsMayNotNonCombatMoveIntoControlledSeaZones(data);</span>
<span class="nc bnc" id="L203" title="All 4 branches missed.">        if (!isCombatMove &amp;&amp; navalMayNotNonComIntoControlled</span>
<span class="nc bnc" id="L204" title="All 2 branches missed.">            &amp;&amp; Matches.isTerritoryEnemyAndNotUnownedWater(player, data).match(t)) {</span>
<span class="nc" id="L205">          return false;</span>
        }
<span class="nc" id="L207">        final Match&lt;Territory&gt; match = new CompositeMatchAnd&lt;&gt;(Matches.territoryDoesNotCostMoneyToEnter(data),</span>
<span class="nc" id="L208">            Matches.TerritoryIsPassableAndNotRestrictedAndOkByRelationships(player, data, isCombatMove, false, true,</span>
<span class="nc" id="L209">                false, false));</span>
<span class="nc" id="L210">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryCanMoveSeaUnitsThrough(final PlayerID player, final GameData data,
      final boolean isCombatMove) {
<span class="nc" id="L217">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L220">        final Match&lt;Territory&gt; match = new CompositeMatchAnd&lt;&gt;(territoryCanMoveSeaUnits(player, data, isCombatMove),</span>
<span class="nc" id="L221">            territoryHasOnlyIgnoredUnits(player, data));</span>
<span class="nc" id="L222">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryCanMoveSeaUnitsAndNotInList(final PlayerID player, final GameData data,
      final boolean isCombatMove, final List&lt;Territory&gt; notTerritories) {
<span class="nc" id="L229">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L232">        final Match&lt;Territory&gt; match = new CompositeMatchAnd&lt;&gt;(territoryCanMoveSeaUnits(player, data, isCombatMove),</span>
<span class="nc" id="L233">            Matches.territoryIsNotInList(notTerritories));</span>
<span class="nc" id="L234">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryCanMoveSeaUnitsThroughOrClearedAndNotInList(final PlayerID player,
      final GameData data, final boolean isCombatMove, final List&lt;Territory&gt; clearedTerritories,
      final List&lt;Territory&gt; notTerritories) {
<span class="nc" id="L242">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L245">        final Match&lt;Territory&gt; onlyIgnoredOrClearedMatch = new CompositeMatchOr&lt;&gt;(</span>
<span class="nc" id="L246">            territoryHasOnlyIgnoredUnits(player, data), Matches.territoryIsInList(clearedTerritories));</span>
<span class="nc" id="L247">        final Match&lt;Territory&gt; match = new CompositeMatchAnd&lt;&gt;(territoryCanMoveSeaUnits(player, data, isCombatMove),</span>
<span class="nc" id="L248">            onlyIgnoredOrClearedMatch, Matches.territoryIsNotInList(notTerritories));</span>
<span class="nc" id="L249">        return match.match(t);</span>
      }
    };
  }

  private static Match&lt;Territory&gt; territoryHasOnlyIgnoredUnits(final PlayerID player, final GameData data) {
<span class="nc" id="L255">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L258">        final CompositeMatch&lt;Unit&gt; subOnly = new CompositeMatchOr&lt;&gt;(Matches.UnitIsInfrastructure, Matches.UnitIsSub,</span>
<span class="nc" id="L259">            Matches.enemyUnit(player, data).invert());</span>
<span class="nc bnc" id="L260" title="All 4 branches missed.">        return (Properties.getIgnoreSubInMovement(data) &amp;&amp; t.getUnits().allMatch(subOnly))</span>
<span class="nc bnc" id="L261" title="All 2 branches missed.">            || Matches.territoryHasNoEnemyUnits(player, data).match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryHasEnemyUnitsOrCantBeHeld(final PlayerID player, final GameData data,
      final List&lt;Territory&gt; territoriesThatCantBeHeld) {
<span class="nc" id="L268">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L271">        final Match&lt;Territory&gt; match = new CompositeMatchOr&lt;&gt;(Matches.territoryHasEnemyUnits(player, data),</span>
<span class="nc" id="L272">            Matches.territoryIsInList(territoriesThatCantBeHeld));</span>
<span class="nc" id="L273">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryHasPotentialEnemyUnits(final PlayerID player, final GameData data,
      final List&lt;PlayerID&gt; players) {
<span class="nc" id="L280">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L283">        final Match&lt;Territory&gt; match = new CompositeMatchOr&lt;&gt;(Matches.territoryHasEnemyUnits(player, data),</span>
<span class="nc" id="L284">            Matches.territoryHasUnitsThatMatch(Matches.unitOwnedBy(players)));</span>
<span class="nc" id="L285">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryHasNoEnemyUnitsOrCleared(final PlayerID player, final GameData data,
      final List&lt;Territory&gt; clearedTerritories) {
<span class="nc" id="L292">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L295">        final Match&lt;Territory&gt; match = new CompositeMatchOr&lt;&gt;(Matches.territoryHasNoEnemyUnits(player, data),</span>
<span class="nc" id="L296">            Matches.territoryIsInList(clearedTerritories));</span>
<span class="nc" id="L297">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryIsEnemyOrHasEnemyUnitsOrCantBeHeld(final PlayerID player, final GameData data,
      final List&lt;Territory&gt; territoriesThatCantBeHeld) {
<span class="nc" id="L304">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L307">        final Match&lt;Territory&gt; match = new CompositeMatchOr&lt;&gt;(Matches.isTerritoryEnemyAndNotUnownedWater(player, data),</span>
<span class="nc" id="L308">            Matches.territoryHasEnemyUnits(player, data), Matches.territoryIsInList(territoriesThatCantBeHeld));</span>
<span class="nc" id="L309">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryHasInfraFactoryAndIsLand(final PlayerID player) {
<span class="nc" id="L315">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L318">        final Match&lt;Unit&gt; infraFactoryMatch =</span>
<span class="nc" id="L319">            new CompositeMatchAnd&lt;&gt;(Matches.UnitCanProduceUnits, Matches.UnitIsInfrastructure);</span>
<span class="nc" id="L320">        final Match&lt;Territory&gt; match =</span>
<span class="nc" id="L321">            new CompositeMatchAnd&lt;&gt;(Matches.TerritoryIsLand, Matches.territoryHasUnitsThatMatch(infraFactoryMatch));</span>
<span class="nc" id="L322">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryHasInfraFactoryAndIsEnemyLand(final PlayerID player, final GameData data) {
<span class="nc" id="L328">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L331">        final Match&lt;Territory&gt; match =</span>
<span class="nc" id="L332">            new CompositeMatchAnd&lt;&gt;(territoryHasInfraFactoryAndIsLand(player), Matches.isTerritoryEnemy(player, data));</span>
<span class="nc" id="L333">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryHasInfraFactoryAndIsOwnedByPlayersOrCantBeHeld(final PlayerID player,
      final GameData data, final List&lt;PlayerID&gt; players, final List&lt;Territory&gt; territoriesThatCantBeHeld) {
<span class="nc" id="L340">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L343">        final Match&lt;Territory&gt; ownedAndCantBeHeld = new CompositeMatchAnd&lt;&gt;(Matches.isTerritoryOwnedBy(player),</span>
<span class="nc" id="L344">            Matches.territoryIsInList(territoriesThatCantBeHeld));</span>
<span class="nc" id="L345">        final Match&lt;Territory&gt; enemyOrOwnedCantBeHeld =</span>
<span class="nc" id="L346">            new CompositeMatchOr&lt;&gt;(Matches.isTerritoryOwnedBy(players), ownedAndCantBeHeld);</span>
<span class="nc" id="L347">        final Match&lt;Territory&gt; match =</span>
<span class="nc" id="L348">            new CompositeMatchAnd&lt;&gt;(territoryHasInfraFactoryAndIsLand(player), enemyOrOwnedCantBeHeld);</span>
<span class="nc" id="L349">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryHasInfraFactoryAndIsNotConqueredOwnedLand(final PlayerID player,
      final GameData data) {
<span class="nc" id="L356">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L359">        final Match&lt;Territory&gt; match = new CompositeMatchAnd&lt;&gt;(territoryIsNotConqueredOwnedLand(player, data),</span>
<span class="nc" id="L360">            territoryHasInfraFactoryAndIsOwnedLand(player));</span>
<span class="nc" id="L361">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryHasNonMobileInfraFactoryAndIsNotConqueredOwnedLand(final PlayerID player,
      final GameData data) {
<span class="nc" id="L368">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L371">        final Match&lt;Territory&gt; match = new CompositeMatchAnd&lt;&gt;(territoryHasNonMobileInfraFactory(),</span>
<span class="nc" id="L372">            territoryHasInfraFactoryAndIsNotConqueredOwnedLand(player, data));</span>
<span class="nc" id="L373">        return match.match(t);</span>
      }
    };
  }

  private static Match&lt;Territory&gt; territoryHasNonMobileInfraFactory() {
<span class="nc" id="L379">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L382">        final Match&lt;Unit&gt; nonMobileInfraFactoryMatch = new CompositeMatchAnd&lt;&gt;(Matches.UnitCanProduceUnits,</span>
<span class="nc" id="L383">            Matches.UnitIsInfrastructure, Matches.unitHasMovementLeft.invert());</span>
<span class="nc" id="L384">        final Match&lt;Territory&gt; match = Matches.territoryHasUnitsThatMatch(nonMobileInfraFactoryMatch);</span>
<span class="nc" id="L385">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryHasInfraFactoryAndIsOwnedLand(final PlayerID player) {
<span class="nc" id="L391">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L394">        final Match&lt;Unit&gt; infraFactoryMatch = new CompositeMatchAnd&lt;&gt;(Matches.unitIsOwnedBy(player),</span>
<span class="nc" id="L395">            Matches.UnitCanProduceUnits, Matches.UnitIsInfrastructure);</span>
<span class="nc" id="L396">        final Match&lt;Territory&gt; match = new CompositeMatchAnd&lt;&gt;(Matches.isTerritoryOwnedBy(player),</span>
<span class="nc" id="L397">            Matches.TerritoryIsLand, Matches.territoryHasUnitsThatMatch(infraFactoryMatch));</span>
<span class="nc" id="L398">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryHasInfraFactoryAndIsAlliedLand(final PlayerID player, final GameData data) {
<span class="nc" id="L404">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L407">        final Match&lt;Unit&gt; infraFactoryMatch =</span>
<span class="nc" id="L408">            new CompositeMatchAnd&lt;&gt;(Matches.UnitCanProduceUnits, Matches.UnitIsInfrastructure);</span>
<span class="nc" id="L409">        final Match&lt;Territory&gt; match = new CompositeMatchAnd&lt;&gt;(Matches.isTerritoryAllied(player, data),</span>
<span class="nc" id="L410">            Matches.TerritoryIsLand, Matches.territoryHasUnitsThatMatch(infraFactoryMatch));</span>
<span class="nc" id="L411">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryHasInfraFactoryAndIsOwnedLandAdjacentToSea(final PlayerID player,
      final GameData data) {
<span class="nc" id="L418">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L421">        final Match&lt;Territory&gt; match = new CompositeMatchAnd&lt;&gt;(territoryHasInfraFactoryAndIsOwnedLand(player),</span>
<span class="nc" id="L422">            Matches.territoryHasNeighborMatching(data, Matches.TerritoryIsWater));</span>
<span class="nc" id="L423">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryHasNoInfraFactoryAndIsNotConqueredOwnedLand(final PlayerID player,
      final GameData data) {
<span class="nc" id="L430">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L433">        final Match&lt;Territory&gt; match = new CompositeMatchAnd&lt;&gt;(territoryIsNotConqueredOwnedLand(player, data),</span>
<span class="nc" id="L434">            territoryHasInfraFactoryAndIsOwnedLand(player).invert());</span>
<span class="nc" id="L435">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryHasNeighborOwnedByAndHasLandUnit(final GameData data, final PlayerID player,
      final List&lt;PlayerID&gt; players) {
<span class="nc" id="L442">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L445">        final Match&lt;Territory&gt; territoryMatch = new CompositeMatchAnd&lt;&gt;(Matches.isTerritoryOwnedBy(players),</span>
<span class="nc" id="L446">            Matches.territoryHasUnitsThatMatch(Matches.UnitIsLand));</span>
<span class="nc" id="L447">        final Match&lt;Territory&gt; match = Matches.territoryHasNeighborMatching(data, territoryMatch);</span>
<span class="nc" id="L448">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryIsAlliedLandAndHasNoEnemyNeighbors(final PlayerID player,
      final GameData data) {
<span class="nc" id="L455">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L458">        final Match&lt;Territory&gt; alliedLand = new CompositeMatchAnd&lt;&gt;(territoryCanMoveLandUnits(player, data, false),</span>
<span class="nc" id="L459">            Matches.isTerritoryAllied(player, data));</span>
<span class="nc" id="L460">        final Match&lt;Territory&gt; hasNoEnemyNeighbors = Matches</span>
<span class="nc" id="L461">            .territoryHasNeighborMatching(data, ProMatches.territoryIsEnemyNotNeutralLand(player, data)).invert();</span>
<span class="nc" id="L462">        final Match&lt;Territory&gt; match = new CompositeMatchAnd&lt;&gt;(alliedLand, hasNoEnemyNeighbors);</span>
<span class="nc" id="L463">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryIsEnemyLand(final PlayerID player, final GameData data) {
<span class="nc" id="L469">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L472">        final Match&lt;Territory&gt; match = new CompositeMatchAnd&lt;&gt;(territoryCanMoveLandUnits(player, data, false),</span>
<span class="nc" id="L473">            Matches.isTerritoryEnemy(player, data));</span>
<span class="nc" id="L474">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryIsEnemyNotNeutralLand(final PlayerID player, final GameData data) {
<span class="nc" id="L480">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L483">        final Match&lt;Territory&gt; match =</span>
<span class="nc" id="L484">            new CompositeMatchAnd&lt;&gt;(territoryIsEnemyLand(player, data), Matches.TerritoryIsNeutralButNotWater.invert());</span>
<span class="nc" id="L485">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryIsOrAdjacentToEnemyNotNeutralLand(final PlayerID player,
      final GameData data) {
<span class="nc" id="L492">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L495">        final Match&lt;Territory&gt; isMatch =</span>
<span class="nc" id="L496">            new CompositeMatchAnd&lt;&gt;(territoryIsEnemyLand(player, data), Matches.TerritoryIsNeutralButNotWater.invert());</span>
<span class="nc" id="L497">        final Match&lt;Territory&gt; adjacentMatch = new CompositeMatchAnd&lt;&gt;(territoryCanMoveLandUnits(player, data, false),</span>
<span class="nc" id="L498">            Matches.territoryHasNeighborMatching(data, isMatch));</span>
<span class="nc" id="L499">        final Match&lt;Territory&gt; match = new CompositeMatchOr&lt;&gt;(isMatch, adjacentMatch);</span>
<span class="nc" id="L500">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryIsEnemyNotNeutralOrAllied(final PlayerID player, final GameData data) {
<span class="nc" id="L506">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L509">        final Match&lt;Territory&gt; alliedLand =</span>
<span class="nc" id="L510">            new CompositeMatchAnd&lt;&gt;(Matches.TerritoryIsLand, Matches.isTerritoryAllied(player, data));</span>
<span class="nc" id="L511">        final Match&lt;Territory&gt; match = new CompositeMatchOr&lt;&gt;(territoryIsEnemyNotNeutralLand(player, data), alliedLand);</span>
<span class="nc" id="L512">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryIsEnemyOrCantBeHeld(final PlayerID player, final GameData data,
      final List&lt;Territory&gt; territoriesThatCantBeHeld) {
<span class="nc" id="L519">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L522">        final Match&lt;Territory&gt; match = new CompositeMatchOr&lt;&gt;(Matches.isTerritoryEnemyAndNotUnownedWater(player, data),</span>
<span class="nc" id="L523">            Matches.territoryIsInList(territoriesThatCantBeHeld));</span>
<span class="nc" id="L524">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryIsPotentialEnemy(final PlayerID player, final GameData data,
      final List&lt;PlayerID&gt; players) {
<span class="nc" id="L531">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L534">        final Match&lt;Territory&gt; match = new CompositeMatchOr&lt;&gt;(Matches.isTerritoryEnemyAndNotUnownedWater(player, data),</span>
<span class="nc" id="L535">            Matches.isTerritoryOwnedBy(players));</span>
<span class="nc" id="L536">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryIsPotentialEnemyOrHasPotentialEnemyUnits(final PlayerID player,
      final GameData data, final List&lt;PlayerID&gt; players) {
<span class="nc" id="L543">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L546">        final Match&lt;Territory&gt; match = new CompositeMatchOr&lt;&gt;(territoryIsPotentialEnemy(player, data, players),</span>
<span class="nc" id="L547">            territoryHasPotentialEnemyUnits(player, data, players));</span>
<span class="nc" id="L548">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryIsEnemyOrCantBeHeldAndIsAdjacentToMyLandUnits(final PlayerID player,
      final GameData data, final List&lt;Territory&gt; territoriesThatCantBeHeld) {
<span class="nc" id="L555">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L558">        final Match&lt;Unit&gt; myUnitIsLand = new CompositeMatchAnd&lt;&gt;(Matches.unitIsOwnedBy(player), Matches.UnitIsLand);</span>
<span class="nc" id="L559">        final Match&lt;Territory&gt; territoryIsLandAndAdjacentToMyLandUnits =</span>
<span class="nc" id="L560">            new CompositeMatchAnd&lt;&gt;(Matches.TerritoryIsLand,</span>
<span class="nc" id="L561">                Matches.territoryHasNeighborMatching(data, Matches.territoryHasUnitsThatMatch(myUnitIsLand)));</span>
<span class="nc" id="L562">        final Match&lt;Territory&gt; match = new CompositeMatchAnd&lt;&gt;(territoryIsLandAndAdjacentToMyLandUnits,</span>
<span class="nc" id="L563">            territoryIsEnemyOrCantBeHeld(player, data, territoriesThatCantBeHeld));</span>
<span class="nc" id="L564">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryIsNotConqueredAlliedLand(final PlayerID player, final GameData data) {
<span class="nc" id="L570">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc bnc" id="L573" title="All 2 branches missed.">        if (AbstractMoveDelegate.getBattleTracker(data).wasConquered(t)) {</span>
<span class="nc" id="L574">          return false;</span>
        }
<span class="nc" id="L576">        final Match&lt;Territory&gt; match =</span>
<span class="nc" id="L577">            new CompositeMatchAnd&lt;&gt;(Matches.isTerritoryAllied(player, data), Matches.TerritoryIsLand);</span>
<span class="nc" id="L578">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryIsNotConqueredOwnedLand(final PlayerID player, final GameData data) {
<span class="nc" id="L584">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc bnc" id="L587" title="All 2 branches missed.">        if (AbstractMoveDelegate.getBattleTracker(data).wasConquered(t)) {</span>
<span class="nc" id="L588">          return false;</span>
        }
<span class="nc" id="L590">        final Match&lt;Territory&gt; match =</span>
<span class="nc" id="L591">            new CompositeMatchAnd&lt;&gt;(Matches.isTerritoryOwnedBy(player), Matches.TerritoryIsLand);</span>
<span class="nc" id="L592">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Territory&gt; territoryIsWaterAndAdjacentToOwnedFactory(final PlayerID player, final GameData data) {
<span class="nc" id="L598">    return new Match&lt;Territory&gt;() {</span>
      @Override
      public boolean match(final Territory t) {
<span class="nc" id="L601">        final Match&lt;Territory&gt; hasOwnedFactoryNeighbor =</span>
<span class="nc" id="L602">            Matches.territoryHasNeighborMatching(data, ProMatches.territoryHasInfraFactoryAndIsOwnedLand(player));</span>
<span class="nc" id="L603">        final Match&lt;Territory&gt; match =</span>
<span class="nc" id="L604">            new CompositeMatchAnd&lt;&gt;(hasOwnedFactoryNeighbor, ProMatches.territoryCanMoveSeaUnits(player, data, true));</span>
<span class="nc" id="L605">        return match.match(t);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitCanBeMovedAndIsOwned(final PlayerID player) {
<span class="nc" id="L611">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc" id="L614">        final Match&lt;Unit&gt; match = new CompositeMatchAnd&lt;&gt;(Matches.unitIsOwnedBy(player), Matches.unitHasMovementLeft);</span>
<span class="nc" id="L615">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitCanBeMovedAndIsOwnedAir(final PlayerID player, final boolean isCombatMove) {
<span class="nc" id="L621">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc bnc" id="L624" title="All 4 branches missed.">        if (isCombatMove &amp;&amp; Matches.UnitCanNotMoveDuringCombatMove.match(u)) {</span>
<span class="nc" id="L625">          return false;</span>
        }
<span class="nc" id="L627">        final Match&lt;Unit&gt; match = new CompositeMatchAnd&lt;&gt;(unitCanBeMovedAndIsOwned(player), Matches.UnitIsAir);</span>
<span class="nc" id="L628">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitCanBeMovedAndIsOwnedLand(final PlayerID player, final boolean isCombatMove) {
<span class="nc" id="L634">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc bnc" id="L637" title="All 4 branches missed.">        if (isCombatMove &amp;&amp; Matches.UnitCanNotMoveDuringCombatMove.match(u)) {</span>
<span class="nc" id="L638">          return false;</span>
        }
<span class="nc" id="L640">        final Match&lt;Unit&gt; match = new CompositeMatchAnd&lt;&gt;(unitCanBeMovedAndIsOwned(player), Matches.UnitIsLand,</span>
<span class="nc" id="L641">            Matches.unitIsBeingTransported().invert());</span>
<span class="nc" id="L642">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitCanBeMovedAndIsOwnedSea(final PlayerID player, final boolean isCombatMove) {
<span class="nc" id="L648">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc bnc" id="L651" title="All 4 branches missed.">        if (isCombatMove &amp;&amp; Matches.UnitCanNotMoveDuringCombatMove.match(u)) {</span>
<span class="nc" id="L652">          return false;</span>
        }
<span class="nc" id="L654">        final Match&lt;Unit&gt; match = new CompositeMatchAnd&lt;&gt;(unitCanBeMovedAndIsOwned(player), Matches.UnitIsSea);</span>
<span class="nc" id="L655">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitCanBeMovedAndIsOwnedTransport(final PlayerID player, final boolean isCombatMove) {
<span class="nc" id="L661">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc bnc" id="L664" title="All 4 branches missed.">        if (isCombatMove &amp;&amp; Matches.UnitCanNotMoveDuringCombatMove.match(u)) {</span>
<span class="nc" id="L665">          return false;</span>
        }
<span class="nc" id="L667">        final Match&lt;Unit&gt; match = new CompositeMatchAnd&lt;&gt;(unitCanBeMovedAndIsOwned(player), Matches.UnitIsTransport);</span>
<span class="nc" id="L668">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitCanBeMovedAndIsOwnedBombard(final PlayerID player) {
<span class="nc" id="L674">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc bnc" id="L677" title="All 2 branches missed.">        if (Matches.UnitCanNotMoveDuringCombatMove.match(u)) {</span>
<span class="nc" id="L678">          return false;</span>
        }
<span class="nc" id="L680">        final Match&lt;Unit&gt; match =</span>
<span class="nc" id="L681">            new CompositeMatchAnd&lt;&gt;(unitCanBeMovedAndIsOwned(player), Matches.unitCanBombard(player));</span>
<span class="nc" id="L682">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitCanBeMovedAndIsOwnedNonCombatInfra(final PlayerID player) {
<span class="nc" id="L688">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc" id="L691">        final Match&lt;Unit&gt; match = new CompositeMatchAnd&lt;&gt;(unitCanBeMovedAndIsOwned(player),</span>
<span class="nc" id="L692">            Matches.UnitCanNotMoveDuringCombatMove, Matches.UnitIsInfrastructure);</span>
<span class="nc" id="L693">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitCantBeMovedAndIsAlliedDefender(final PlayerID player, final GameData data,
      final Territory t) {
<span class="nc" id="L700">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc" id="L703">        final Match&lt;Unit&gt; myUnitHasNoMovementMatch =</span>
<span class="nc" id="L704">            new CompositeMatchAnd&lt;&gt;(Matches.unitIsOwnedBy(player), Matches.unitHasMovementLeft.invert());</span>
<span class="nc" id="L705">        final Match&lt;Unit&gt; alliedUnitMatch =</span>
<span class="nc" id="L706">            new CompositeMatchAnd&lt;&gt;(Matches.unitIsOwnedBy(player).invert(), Matches.isUnitAllied(player, data),</span>
<span class="nc" id="L707">                Matches.unitIsBeingTransportedByOrIsDependentOfSomeUnitInThisList(t.getUnits().getUnits(), null, player,</span>
<span class="nc" id="L708">                    data, false).invert());</span>
<span class="nc" id="L709">        final Match&lt;Unit&gt; match = new CompositeMatchOr&lt;&gt;(myUnitHasNoMovementMatch, alliedUnitMatch);</span>
<span class="nc" id="L710">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitCantBeMovedAndIsAlliedDefenderAndNotInfra(final PlayerID player, final GameData data,
      final Territory t) {
<span class="nc" id="L717">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc" id="L720">        final Match&lt;Unit&gt; match = new CompositeMatchAnd&lt;&gt;(unitCantBeMovedAndIsAlliedDefender(player, data, t),</span>
<span class="nc" id="L721">            Matches.UnitIsNotInfrastructure);</span>
<span class="nc" id="L722">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitIsAlliedLandAndNotInfra(final PlayerID player, final GameData data) {
<span class="nc" id="L728">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc" id="L731">        final Match&lt;Unit&gt; match = new CompositeMatchAnd&lt;&gt;(Matches.UnitIsLand, Matches.isUnitAllied(player, data),</span>
<span class="nc" id="L732">            Matches.UnitIsNotInfrastructure);</span>
<span class="nc" id="L733">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitIsAlliedNotOwned(final PlayerID player, final GameData data) {
<span class="nc" id="L739">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc" id="L742">        final Match&lt;Unit&gt; match =</span>
<span class="nc" id="L743">            new CompositeMatchAnd&lt;&gt;(Matches.unitIsOwnedBy(player).invert(), Matches.isUnitAllied(player, data));</span>
<span class="nc" id="L744">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitIsAlliedNotOwnedAir(final PlayerID player, final GameData data) {
<span class="nc" id="L750">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc" id="L753">        final Match&lt;Unit&gt; match = new CompositeMatchAnd&lt;&gt;(unitIsAlliedNotOwned(player, data), Matches.UnitIsAir);</span>
<span class="nc" id="L754">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitIsAlliedAir(final PlayerID player, final GameData data) {
<span class="nc" id="L760">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc" id="L763">        final Match&lt;Unit&gt; match = new CompositeMatchAnd&lt;&gt;(Matches.isUnitAllied(player, data), Matches.UnitIsAir);</span>
<span class="nc" id="L764">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitIsEnemyAir(final PlayerID player, final GameData data) {
<span class="nc" id="L770">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc" id="L773">        final Match&lt;Unit&gt; match = new CompositeMatchAnd&lt;&gt;(Matches.enemyUnit(player, data), Matches.UnitIsAir);</span>
<span class="nc" id="L774">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitIsEnemyAndNotAA(final PlayerID player, final GameData data) {
<span class="nc" id="L780">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc" id="L783">        final Match&lt;Unit&gt; match =</span>
<span class="nc" id="L784">            new CompositeMatchAnd&lt;&gt;(Matches.enemyUnit(player, data), Matches.UnitIsAAforAnything.invert());</span>
<span class="nc" id="L785">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitIsEnemyAndNotInfa(final PlayerID player, final GameData data) {
<span class="nc" id="L791">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc" id="L794">        final Match&lt;Unit&gt; match =</span>
<span class="nc" id="L795">            new CompositeMatchAnd&lt;&gt;(Matches.enemyUnit(player, data), Matches.UnitIsNotInfrastructure);</span>
<span class="nc" id="L796">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitIsEnemyNotLand(final PlayerID player, final GameData data) {
<span class="nc" id="L802">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc" id="L805">        final Match&lt;Unit&gt; match = new CompositeMatchAnd&lt;&gt;(Matches.enemyUnit(player, data), Matches.UnitIsNotLand);</span>
<span class="nc" id="L806">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitIsEnemyNotNeutral(final PlayerID player, final GameData data) {
<span class="nc" id="L812">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc" id="L815">        final Match&lt;Unit&gt; match = new CompositeMatchAnd&lt;&gt;(Matches.enemyUnit(player, data), unitIsNeutral().invert());</span>
<span class="nc" id="L816">        return match.match(u);</span>
      }
    };
  }

  private static Match&lt;Unit&gt; unitIsNeutral() {
<span class="nc" id="L822">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc bnc" id="L825" title="All 2 branches missed.">        if (u.getOwner().isNull()) {</span>
<span class="nc" id="L826">          return true;</span>
        }
<span class="nc" id="L828">        return false;</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitIsOwnedAir(final PlayerID player) {
<span class="nc" id="L834">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc" id="L837">        final Match&lt;Unit&gt; match = new CompositeMatchAnd&lt;&gt;(Matches.unitOwnedBy(player), Matches.UnitIsAir);</span>
<span class="nc" id="L838">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitIsOwnedAndMatchesTypeAndIsTransporting(final PlayerID player, final UnitType unitType) {
<span class="nc" id="L844">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc" id="L847">        final Match&lt;Unit&gt; match = new CompositeMatchAnd&lt;&gt;(Matches.unitIsOwnedBy(player), Matches.unitIsOfType(unitType),</span>
<span class="nc" id="L848">            Matches.unitIsTransporting());</span>
<span class="nc" id="L849">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitIsOwnedAndMatchesTypeAndNotTransporting(final PlayerID player,
      final UnitType unitType) {
<span class="nc" id="L856">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc" id="L859">        final Match&lt;Unit&gt; match = new CompositeMatchAnd&lt;&gt;(Matches.unitIsOwnedBy(player), Matches.unitIsOfType(unitType),</span>
<span class="nc" id="L860">            Matches.unitIsTransporting().invert());</span>
<span class="nc" id="L861">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; UnitIsOwnedCarrier(final PlayerID player) {
<span class="nc" id="L867">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc" id="L870">        final UnitAttachment ua = UnitAttachment.get(u.getType());</span>
<span class="nc bnc" id="L871" title="All 4 branches missed.">        return ua.getCarrierCapacity() != -1 &amp;&amp; Matches.unitIsOwnedBy(player).match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitIsOwnedNotLand(final PlayerID player, final GameData data) {
<span class="nc" id="L877">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc" id="L880">        final Match&lt;Unit&gt; match = new CompositeMatchAnd&lt;&gt;(Matches.UnitIsNotLand, Matches.unitIsOwnedBy(player));</span>
<span class="nc" id="L881">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitIsOwnedTransport(final PlayerID player) {
<span class="nc" id="L887">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc" id="L890">        final Match&lt;Unit&gt; match = new CompositeMatchAnd&lt;&gt;(Matches.unitIsOwnedBy(player), Matches.UnitIsTransport);</span>
<span class="nc" id="L891">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitIsOwnedTransportableUnit(final PlayerID player) {
<span class="nc" id="L897">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc" id="L900">        final Match&lt;Unit&gt; match =</span>
<span class="nc" id="L901">            new CompositeMatchAnd&lt;&gt;(Matches.unitIsOwnedBy(player), Matches.UnitCanBeTransported, Matches.UnitCanMove);</span>
<span class="nc" id="L902">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitIsOwnedCombatTransportableUnit(final PlayerID player) {
<span class="nc" id="L908">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc" id="L911">        final Match&lt;Unit&gt; match = new CompositeMatchAnd&lt;&gt;(Matches.unitIsOwnedBy(player), Matches.UnitCanBeTransported,</span>
<span class="nc" id="L912">            Matches.UnitCanNotMoveDuringCombatMove.invert(), Matches.UnitCanMove);</span>
<span class="nc" id="L913">        return match.match(u);</span>
      }
    };
  }

  public static Match&lt;Unit&gt; unitIsOwnedTransportableUnitAndCanBeLoaded(final PlayerID player,
      final boolean isCombatMove) {
<span class="nc" id="L920">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit u) {
<span class="nc bnc" id="L923" title="All 4 branches missed.">        if (isCombatMove &amp;&amp; Matches.UnitCanNotMoveDuringCombatMove.match(u)) {</span>
<span class="nc" id="L924">          return false;</span>
        }
<span class="nc" id="L926">        final Match&lt;Unit&gt; match = new CompositeMatchAnd&lt;&gt;(unitIsOwnedTransportableUnit(player), Matches.unitHasNotMoved,</span>
<span class="nc" id="L927">            Matches.unitHasMovementLeft, Matches.unitIsBeingTransported().invert());</span>
<span class="nc" id="L928">        return match.match(u);</span>
      }
    };
  }

  /**
   * Check what units a territory can produce.
   *
   * @param t
   *        territory we are testing for required units
   * @return whether the territory contains one of the required combos of units
   */
  public static Match&lt;Unit&gt; unitWhichRequiresUnitsHasRequiredUnits(final PlayerID player, final Territory t) {
<span class="nc" id="L941">    return new Match&lt;Unit&gt;() {</span>
      @Override
      public boolean match(final Unit unitWhichRequiresUnits) {
<span class="nc bnc" id="L944" title="All 2 branches missed.">        if (!Matches.UnitRequiresUnitsOnCreation.match(unitWhichRequiresUnits)) {</span>
<span class="nc" id="L945">          return true;</span>
        }
<span class="nc" id="L947">        final Collection&lt;Unit&gt; unitsAtStartOfTurnInProducer = t.getUnits().getUnits();</span>
<span class="nc" id="L948">        if (Matches.UnitWhichRequiresUnitsHasRequiredUnitsInList(unitsAtStartOfTurnInProducer)</span>
<span class="nc bnc" id="L949" title="All 2 branches missed.">            .match(unitWhichRequiresUnits)) {</span>
<span class="nc" id="L950">          return true;</span>
        }
<span class="nc bnc" id="L952" title="All 4 branches missed.">        if (t.isWater() &amp;&amp; Matches.UnitIsSea.match(unitWhichRequiresUnits)) {</span>
<span class="nc bnc" id="L953" title="All 2 branches missed.">          for (final Territory neighbor : t.getData().getMap().getNeighbors(t, Matches.TerritoryIsLand)) {</span>
<span class="nc" id="L954">            final Collection&lt;Unit&gt; unitsAtStartOfTurnInCurrent = neighbor.getUnits().getUnits();</span>
<span class="nc" id="L955">            if (Matches.UnitWhichRequiresUnitsHasRequiredUnitsInList(unitsAtStartOfTurnInCurrent)</span>
<span class="nc bnc" id="L956" title="All 2 branches missed.">                .match(unitWhichRequiresUnits)) {</span>
<span class="nc" id="L957">              return true;</span>
            }
          }
        }
<span class="nc" id="L961">        return false;</span>
      }
    };
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span>test (25/nov/2016 10:16:58)</div></body></html>