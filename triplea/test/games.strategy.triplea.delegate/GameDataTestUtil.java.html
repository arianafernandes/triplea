<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>GameDataTestUtil.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">test (25/nov/2016 10:16:58)</a> &gt; <a href="../../index.html" class="el_group">triplea</a> &gt; <a href="../index.html" class="el_bundle">test</a> &gt; <a href="index.source.html" class="el_package">games.strategy.triplea.delegate</a> &gt; <span class="el_source">GameDataTestUtil.java</span></div><h1>GameDataTestUtil.java</h1><pre class="source lang-java linenums">package games.strategy.triplea.delegate;

import static org.mockito.Mockito.mock;

import java.util.Collection;
import java.util.List;

import org.junit.Assert;

import games.strategy.engine.data.GameData;
import games.strategy.engine.data.ITestDelegateBridge;
import games.strategy.engine.data.PlayerID;
import games.strategy.engine.data.Route;
import games.strategy.engine.data.Territory;
import games.strategy.engine.data.TestDelegateBridge;
import games.strategy.engine.data.Unit;
import games.strategy.engine.data.UnitType;
import games.strategy.engine.data.changefactory.ChangeFactory;
import games.strategy.engine.data.properties.BooleanProperty;
import games.strategy.engine.data.properties.IEditableProperty;
import games.strategy.triplea.Constants;
import games.strategy.triplea.attachments.TechAttachment;
import games.strategy.triplea.ui.display.ITripleADisplay;
import junit.framework.AssertionFailedError;

<span class="nc" id="L26">public class GameDataTestUtil {</span>
  public static PlayerID germans(final GameData data) {
<span class="fc" id="L28">    return data.getPlayerList().getPlayerID(Constants.PLAYER_NAME_GERMANS);</span>
  }

  public static PlayerID italians(final GameData data) {
<span class="fc" id="L32">    return data.getPlayerList().getPlayerID(Constants.PLAYER_NAME_ITALIANS);</span>
  }

  public static PlayerID russians(final GameData data) {
<span class="fc" id="L36">    return data.getPlayerList().getPlayerID(Constants.PLAYER_NAME_RUSSIANS);</span>
  }

  public static PlayerID americans(final GameData data) {
<span class="fc" id="L40">    return data.getPlayerList().getPlayerID(Constants.PLAYER_NAME_AMERICANS);</span>
  }

  public static PlayerID british(final GameData data) {
<span class="fc" id="L44">    return data.getPlayerList().getPlayerID(Constants.PLAYER_NAME_BRITISH);</span>
  }

  public static PlayerID japanese(final GameData data) {
<span class="fc" id="L48">    return data.getPlayerList().getPlayerID(Constants.PLAYER_NAME_JAPANESE);</span>
  }

  public static PlayerID chinese(final GameData data) {
<span class="fc" id="L52">    return data.getPlayerList().getPlayerID(Constants.PLAYER_NAME_CHINESE);</span>
  }

  public static Territory territory(final String name, final GameData data) {
<span class="fc" id="L56">    final Territory t = data.getMap().getTerritory(name);</span>
<span class="pc bpc" id="L57" title="1 of 2 branches missed.">    if (t == null) {</span>
<span class="nc" id="L58">      throw new IllegalStateException(&quot;no territory:&quot; + name);</span>
    }
<span class="fc" id="L60">    return t;</span>
  }

  public static UnitType armour(final GameData data) {
<span class="fc" id="L64">    return unitType(Constants.UNIT_TYPE_ARMOUR, data);</span>
  }

  public static UnitType aaGun(final GameData data) {
<span class="fc" id="L68">    return unitType(Constants.UNIT_TYPE_AAGUN, data);</span>
  }

  public static UnitType transport(final GameData data) {
<span class="fc" id="L72">    return unitType(Constants.UNIT_TYPE_TRANSPORT, data);</span>
  }

  public static UnitType battleship(final GameData data) {
<span class="fc" id="L76">    return unitType(Constants.UNIT_TYPE_BATTLESHIP, data);</span>
  }

  public static UnitType carrier(final GameData data) {
<span class="fc" id="L80">    return unitType(Constants.UNIT_TYPE_CARRIER, data);</span>
  }

  // Some units hard coded here rather than placed in Constants at the request of community members Ref: Pull Request 1074
  public static UnitType tacBomber(final GameData data) {
<span class="fc" id="L85">    return unitType(&quot;tactical_bomber&quot;, data);			</span>
  }

  public static UnitType airbase(final GameData data) {
<span class="nc" id="L89">    return unitType(&quot;airbase&quot;, data);			</span>
  }

  public static UnitType harbour(final GameData data) {
<span class="nc" id="L93">    return unitType(&quot;harbour&quot;, data);			</span>
  }

  public static UnitType factoryMajor(final GameData data) {
<span class="nc" id="L97">    return unitType(&quot;factory_major&quot;, data);			</span>
  }

  public static UnitType factoryMinor(final GameData data) {
<span class="nc" id="L101">    return unitType(&quot;factory_minor&quot;, data);			</span>
  }

  public static UnitType fighter(final GameData data) {
<span class="fc" id="L105">    return unitType(Constants.UNIT_TYPE_FIGHTER, data);</span>
  }

  public static UnitType destroyer(final GameData data) {
<span class="fc" id="L109">    return unitType(Constants.UNIT_TYPE_DESTROYER, data);</span>
  }

  public static UnitType submarine(final GameData data) {
<span class="fc" id="L113">    return unitType(Constants.UNIT_TYPE_SUBMARINE, data);</span>
  }

  public static UnitType infantry(final GameData data) {
<span class="fc" id="L117">    return unitType(Constants.UNIT_TYPE_INFANTRY, data);</span>
  }

  public static UnitType bomber(final GameData data) {
<span class="fc" id="L121">    return unitType(Constants.UNIT_TYPE_BOMBER, data);</span>
  }

  public static UnitType factory(final GameData data) {
<span class="fc" id="L125">    return unitType(Constants.UNIT_TYPE_FACTORY, data);</span>
  }

  private static UnitType unitType(final String name, final GameData data) {
<span class="fc" id="L129">    return data.getUnitTypeList().getUnitType(name);</span>
  }

  public static void removeFrom(final Territory t, final Collection&lt;Unit&gt; units) {
<span class="fc" id="L133">    t.getData().performChange(ChangeFactory.removeUnits(t, units));</span>
<span class="fc" id="L134">  }</span>

  public static void addTo(final Territory t, final Collection&lt;Unit&gt; units) {
<span class="fc" id="L137">    t.getData().performChange(ChangeFactory.addUnits(t, units));</span>
<span class="fc" id="L138">  }</span>

  public static void addTo(final PlayerID t, final Collection&lt;Unit&gt; units, final GameData data) {
<span class="fc" id="L141">    data.performChange(ChangeFactory.addUnits(t, units));</span>
<span class="fc" id="L142">  }</span>

  public static PlaceDelegate placeDelegate(final GameData data) {
<span class="fc" id="L145">    return (PlaceDelegate) data.getDelegateList().getDelegate(&quot;place&quot;);</span>
  }

  public static BattleDelegate battleDelegate(final GameData data) {
<span class="fc" id="L149">    return (BattleDelegate) data.getDelegateList().getDelegate(&quot;battle&quot;);</span>
  }

  public static MoveDelegate moveDelegate(final GameData data) {
<span class="fc" id="L153">    return (MoveDelegate) data.getDelegateList().getDelegate(&quot;move&quot;);</span>
  }

  public static TechnologyDelegate techDelegate(final GameData data) {
<span class="fc" id="L157">    return (TechnologyDelegate) data.getDelegateList().getDelegate(&quot;tech&quot;);</span>
  }

  public static PurchaseDelegate purchaseDelegate(final GameData data) {
<span class="fc" id="L161">    return (PurchaseDelegate) data.getDelegateList().getDelegate(&quot;purchase&quot;);</span>
  }

  public static BidPlaceDelegate bidPlaceDelegate(final GameData data) {
<span class="fc" id="L165">    return (BidPlaceDelegate) data.getDelegateList().getDelegate(&quot;placeBid&quot;);</span>
  }

  public static ITestDelegateBridge getDelegateBridge(final PlayerID player, final GameData data) {
<span class="fc" id="L169">    return new TestDelegateBridge(data, player, mock(ITripleADisplay.class));</span>
  }

  public static void load(final Collection&lt;Unit&gt; units, final Route route) {
<span class="pc bpc" id="L173" title="1 of 2 branches missed.">    if (units.isEmpty()) {</span>
<span class="nc" id="L174">      throw new AssertionFailedError(&quot;No units&quot;);</span>
    }
<span class="fc" id="L176">    final MoveDelegate moveDelegate = moveDelegate(route.getStart().getData());</span>
<span class="fc" id="L177">    final Collection&lt;Unit&gt; transports =</span>
<span class="fc" id="L178">        route.getEnd().getUnits().getMatches(Matches.unitIsOwnedBy(units.iterator().next().getOwner()));</span>
<span class="fc" id="L179">    final String error = moveDelegate.move(units, route, transports);</span>
<span class="pc bpc" id="L180" title="1 of 2 branches missed.">    if (error != null) {</span>
<span class="nc" id="L181">      throw new AssertionFailedError(&quot;Illegal move:&quot; + error);</span>
    }
<span class="fc" id="L183">  }</span>

  public static void move(final Collection&lt;Unit&gt; units, final Route route) {
<span class="pc bpc" id="L186" title="1 of 2 branches missed.">    if (units.isEmpty()) {</span>
<span class="nc" id="L187">      throw new AssertionFailedError(&quot;No units&quot;);</span>
    }
<span class="fc" id="L189">    final String error = moveDelegate(route.getStart().getData()).move(units, route);</span>
<span class="pc bpc" id="L190" title="1 of 2 branches missed.">    if (error != null) {</span>
<span class="nc" id="L191">      throw new AssertionFailedError(&quot;Illegal move:&quot; + error);</span>
    }
<span class="fc" id="L193">  }</span>

  public static void assertMoveError(final Collection&lt;Unit&gt; units, final Route route) {
<span class="pc bpc" id="L196" title="1 of 2 branches missed.">    if (units.isEmpty()) {</span>
<span class="nc" id="L197">      throw new AssertionFailedError(&quot;No units&quot;);</span>
    }
<span class="fc" id="L199">    final String error = moveDelegate(route.getStart().getData()).move(units, route);</span>
<span class="pc bpc" id="L200" title="1 of 2 branches missed.">    if (error == null) {</span>
<span class="nc" id="L201">      throw new AssertionFailedError(&quot;Should not be Legal move&quot;);</span>
    }
<span class="fc" id="L203">  }</span>

  public static int getIndex(final List&lt;IExecutable&gt; steps, final Class&lt;?&gt; type) {
<span class="fc" id="L206">    int rVal = -1;</span>
<span class="fc" id="L207">    int index = 0;</span>
<span class="fc bfc" id="L208" title="All 2 branches covered.">    for (final IExecutable e : steps) {</span>
<span class="fc bfc" id="L209" title="All 2 branches covered.">      if (type.isInstance(e)) {</span>
<span class="pc bpc" id="L210" title="1 of 2 branches missed.">        if (rVal != -1) {</span>
<span class="nc" id="L211">          throw new AssertionFailedError(&quot;More than one instance:&quot; + steps);</span>
        }
<span class="fc" id="L213">        rVal = index;</span>
      }
<span class="fc" id="L215">      index++;</span>
    }
<span class="pc bpc" id="L217" title="1 of 2 branches missed.">    if (rVal == -1) {</span>
<span class="nc" id="L218">      throw new AssertionFailedError(&quot;No instance:&quot; + steps);</span>
    }
<span class="fc" id="L220">    return rVal;</span>
  }

  public static void setSelectAACasualties(final GameData data, final boolean val) {
<span class="pc bpc" id="L224" title="1 of 2 branches missed.">    for (final IEditableProperty property : data.getProperties().getEditableProperties()) {</span>
<span class="fc bfc" id="L225" title="All 2 branches covered.">      if (property.getName().equals(Constants.CHOOSE_AA)) {</span>
<span class="fc" id="L226">        ((BooleanProperty) property).setValue(val);</span>
<span class="fc" id="L227">        return;</span>
      }
    }
<span class="nc" id="L230">    throw new IllegalStateException();</span>
  }

  public static void makeGameLowLuck(final GameData data) {
<span class="pc bpc" id="L234" title="1 of 2 branches missed.">    for (final IEditableProperty property : data.getProperties().getEditableProperties()) {</span>
<span class="fc bfc" id="L235" title="All 2 branches covered.">      if (property.getName().equals(Constants.LOW_LUCK)) {</span>
<span class="fc" id="L236">        ((BooleanProperty) property).setValue(true);</span>
<span class="fc" id="L237">        return;</span>
      }
    }
<span class="nc" id="L240">    throw new IllegalStateException();</span>
  }

  public static void givePlayerRadar(final PlayerID player) {
<span class="fc" id="L244">    TechAttachment.get(player).setAARadar(Boolean.TRUE.toString());</span>
<span class="fc" id="L245">  }</span>

  public static void assertValid(final String string) {
<span class="fc" id="L248">    Assert.assertNull(string, string);</span>
<span class="fc" id="L249">  }</span>

  public static void assertError(final String string) {
<span class="fc" id="L252">    Assert.assertNotNull(string, string);</span>
<span class="fc" id="L253">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span>test (25/nov/2016 10:16:58)</div></body></html>